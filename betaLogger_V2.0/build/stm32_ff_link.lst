ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 1


   1              		.cpu cortex-m3
   2              		.eabi_attribute 20, 1
   3              		.eabi_attribute 21, 1
   4              		.eabi_attribute 23, 3
   5              		.eabi_attribute 24, 1
   6              		.eabi_attribute 25, 1
   7              		.eabi_attribute 26, 1
   8              		.eabi_attribute 30, 1
   9              		.eabi_attribute 34, 1
  10              		.eabi_attribute 18, 4
  11              		.file	"stm32_ff_link.c"
  12              		.text
  13              	.Ltext0:
  14              		.cfi_sections	.debug_frame
  15              		.section	.text.SPIx_GPIO_Init,"ax",%progbits
  16              		.align	1
  17              		.syntax unified
  18              		.thumb
  19              		.thumb_func
  20              		.fpu softvfp
  22              	SPIx_GPIO_Init:
  23              	.LFB67:
  24              		.file 1 "Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c"
   1:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #include "stm32_ff_link.h"
   2:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #include <stddef.h>
   3:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #include <stdint.h>
   4:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #include <stdlib.h>
   5:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #include <string.h>
   6:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
   7:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_DUMMY_BYTE					0xFF
   8:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_NO_RESPONSE_EXPECTED			0x80
   9:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_PRESENT						((uint8_t)0x01)
  10:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_NOT_PRESENT					((uint8_t)0x00)
  11:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_MAX_TRY						100		// Number of try 
  12:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_LENGTH					6
  13:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
  14:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_GO_IDLE_STATE							0		 // CMD0 = 0x40	
  15:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_SEND_OP_COND								1		 // CMD1 = 0x41	
  16:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_SEND_IF_COND								8		 // CMD8 = 0x48	
  17:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_SEND_CSD									9		 // CMD9 = 0x49	
  18:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_SEND_CID									10		// CMD10 = 0x4A 
  19:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_STOP_TRANSMISSION						12		// CMD12 = 0x4C 
  20:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_SEND_STATUS								13		// CMD13 = 0x4D 
  21:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_SET_BLOCKLEN								16		// CMD16 = 0x50 
  22:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_READ_SINGLE_BLOCK						17		// CMD17 = 0x51 
  23:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_READ_MULT_BLOCK							18		// CMD18 = 0x52 
  24:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_SET_BLOCK_COUNT							23		// CMD23 = 0x57 
  25:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_WRITE_SINGLE_BLOCK						24		// CMD24 = 0x58 
  26:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_WRITE_MULT_BLOCK							25		// CMD25 = 0x59 
  27:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_PROG_CSD									27		// CMD27 = 0x5B 
  28:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_SET_WRITE_PROT							28		// CMD28 = 0x5C 
  29:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_CLR_WRITE_PROT							29		// CMD29 = 0x5D 
  30:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_SEND_WRITE_PROT							30		// CMD30 = 0x5E 
  31:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_SD_ERASE_GRP_START						32		// CMD32 = 0x60 
  32:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_SD_ERASE_GRP_END							33		// CMD33 = 0x61 
  33:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_UNTAG_SECTOR								34		// CMD34 = 0x62 
  34:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_ERASE_GRP_START							35		// CMD35 = 0x63 
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 2


  35:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_ERASE_GRP_END							36		// CMD36 = 0x64 
  36:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_UNTAG_ERASE_GROUP						37		// CMD37 = 0x65 
  37:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_ERASE									38		// CMD38 = 0x66 
  38:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_SD_APP_OP_COND							41		// CMD41 = 0x69 
  39:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_APP_CMD									55		// CMD55 = 0x77 
  40:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_CMD_READ_OCR									58		// CMD55 = 0x79 
  41:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
  42:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_TOKEN_START_DATA_SINGLE_BLOCK_READ			0xFE	// Data token start byte, Start Single Block R
  43:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_TOKEN_START_DATA_MULTIPLE_BLOCK_READ			0xFE	// Data token start byte, Start Multiple Blo
  44:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_TOKEN_START_DATA_SINGLE_BLOCK_WRITE			0xFE	// Data token start byte, Start Single Block 
  45:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_TOKEN_START_DATA_MULTIPLE_BLOCK_WRITE		0xFD	// Data token start byte, Start Multiple Blo
  46:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** #define SD_TOKEN_STOP_DATA_MULTIPLE_BLOCK_WRITE			0xFD	// Data toke stop byte, Stop Multiple Block 
  47:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
  48:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** typedef struct {
  49:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t r1;
  50:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t r2;
  51:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t r3;
  52:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t r4;
  53:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t r5;
  54:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** } SD_CmdAnswer_typedef;
  55:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
  56:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** typedef enum {
  57:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_ANSWER_R1_EXPECTED,
  58:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_ANSWER_R1B_EXPECTED,
  59:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_ANSWER_R2_EXPECTED,
  60:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_ANSWER_R3_EXPECTED,
  61:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_ANSWER_R4R5_EXPECTED,
  62:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_ANSWER_R7_EXPECTED,
  63:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** } SD_Answer_type;
  64:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
  65:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** typedef enum {
  66:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// R1 answer value
  67:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_R1_NO_ERROR						= (0x00),
  68:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_R1_IN_IDLE_STATE					= (0x01),
  69:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_R1_ERASE_RESET					= (0x02),
  70:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_R1_ILLEGAL_COMMAND				= (0x04),
  71:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_R1_COM_CRC_ERROR					= (0x08),
  72:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_R1_ERASE_SEQUENCE_ERROR			= (0x10),
  73:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_R1_ADDRESS_ERROR					= (0x20),
  74:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_R1_PARAMETER_ERROR				= (0x40),
  75:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
  76:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// R2 answer value
  77:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_R2_NO_ERROR						= 0x00,
  78:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_R2_CARD_LOCKED					= 0x01,
  79:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_R2_LOCKUNLOCK_ERROR				= 0x02,
  80:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_R2_ERROR							= 0x04,
  81:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_R2_CC_ERROR						= 0x08,
  82:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_R2_CARD_ECC_FAILED				= 0x10,
  83:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_R2_WP_VIOLATION					= 0x20,
  84:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_R2_ERASE_PARAM					= 0x40,
  85:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_R2_OUTOFRANGE					= 0x80,
  86:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
  87:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_DATA_OK							= (0x05),
  88:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_DATA_CRC_ERROR					= (0x0B),
  89:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_DATA_WRITE_ERROR					= (0x0D),
  90:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_DATA_OTHER_ERROR					= (0xFF)
  91:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** } SD_Error;
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 3


  92:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
  93:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
  94:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** volatile uint8_t SdStatus = SD_NOT_PRESENT;
  95:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** uint16_t flag_SDHC = 0;
  96:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
  97:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static void SPIx_Init(void);
  98:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static void SPIx_GPIO_Init(void);
  99:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static void SPIx_WriteReadData(const uint8_t *DataIn, uint8_t *DataOut, uint16_t DataLength);
 100:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static void SPIx_WriteData(uint8_t *DataIn, uint16_t DataLength);
 101:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static void SPIx_Write(uint8_t Value);
 102:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static void SPIx_Error(void);
 103:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static void SPIx_FlushFifo(void);
 104:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 105:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static uint8_t SD_GoIdleState(void);
 106:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static SD_CmdAnswer_typedef SD_SendCmd(uint8_t Cmd, uint32_t Arg, uint8_t Crc, uint8_t Answer);
 107:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static uint8_t SD_ReadData(void);
 108:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static uint8_t SD_GetDataResponse(void);
 109:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static uint8_t SD_GetCIDRegister(SD_CID *Cid);
 110:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static uint8_t SD_GetCSDRegister(SD_CSD *Csd);
 111:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static uint8_t SD_WaitData(uint8_t data);
 112:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 113:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 114:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static void SPIx_Init(void)
 115:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 116:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (HAL_SPI_GetState(&SD_SPI_HANDLE) == HAL_SPI_STATE_RESET) {
 117:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SPIx_GPIO_Init();
 118:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		/* SPI Config */
 119:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		/* SPI baudrate is set to 12 MHz maximum (PCLK1/SPI_BaudRatePrescaler = 48/4 = 12 MHz)
 120:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		 to verify these constraints:
 121:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		    - SD card SPI interface max baudrate is 25MHz for write/read
 122:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		    - PCLK1 max frequency is 48 MHz
 123:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		 */
 124:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_SPI_HANDLE.Init.BaudRatePrescaler = SD_SPI_BAUD_RATE;
 125:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_SPI_HANDLE.Init.CLKPhase = SPI_PHASE_2EDGE;
 126:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_SPI_HANDLE.Init.CLKPolarity = SPI_POLARITY_HIGH;
 127:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_SPI_HANDLE.Init.CRCCalculation = SPI_CRCCALCULATION_DISABLE;
 128:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** // SD_SPI_HANDLE.Init.CRCLength = SPI_CRC_LENGTH_DATASIZE;
 129:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** // SD_SPI_HANDLE.Init.CRCPolynomial = 7;
 130:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_SPI_HANDLE.Init.DataSize = SPI_DATASIZE_8BIT;
 131:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_SPI_HANDLE.Init.Direction = SPI_DIRECTION_2LINES;
 132:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_SPI_HANDLE.Init.FirstBit = SPI_FIRSTBIT_MSB;
 133:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_SPI_HANDLE.Init.Mode = SPI_MODE_MASTER;
 134:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_SPI_HANDLE.Init.NSS = SPI_NSS_SOFT;
 135:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** // SD_SPI_HANDLE.Init.NSSPMode = SPI_NSS_PULSE_DISABLE;
 136:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_SPI_HANDLE.Init.TIMode = SPI_TIMODE_DISABLE;
 137:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_SPI_HANDLE.Instance = SD_SPI_INSTANCE;
 138:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 139:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		HAL_SPI_Init(&SD_SPI_HANDLE);
 140:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 141:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 142:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 143:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static void SPIx_GPIO_Init(void)
 144:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
  25              		.loc 1 144 0
  26              		.cfi_startproc
  27              		@ args = 0, pretend = 0, frame = 40
  28              		@ frame_needed = 0, uses_anonymous_args = 0
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 4


  29 0000 F0B5     		push	{r4, r5, r6, r7, lr}
  30              	.LCFI0:
  31              		.cfi_def_cfa_offset 20
  32              		.cfi_offset 4, -20
  33              		.cfi_offset 5, -16
  34              		.cfi_offset 6, -12
  35              		.cfi_offset 7, -8
  36              		.cfi_offset 14, -4
  37 0002 8BB0     		sub	sp, sp, #44
  38              	.LCFI1:
  39              		.cfi_def_cfa_offset 64
 145:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	GPIO_InitTypeDef gpioinitstruct = {0};
  40              		.loc 1 145 0
  41 0004 0025     		movs	r5, #0
  42 0006 0895     		str	r5, [sp, #32]
  43              	.LBB2:
 146:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 147:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/*** Configure the GPIOs ***/
 148:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/* Enable GPIO clock */
 149:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_SCLK_GPIO_CLK_ENABLE();
  44              		.loc 1 149 0
  45 0008 254C     		ldr	r4, .L3
  46 000a A369     		ldr	r3, [r4, #24]
  47 000c 43F00403 		orr	r3, r3, #4
  48 0010 A361     		str	r3, [r4, #24]
  49 0012 A369     		ldr	r3, [r4, #24]
  50 0014 03F00403 		and	r3, r3, #4
  51 0018 0193     		str	r3, [sp, #4]
  52 001a 019B     		ldr	r3, [sp, #4]
  53              	.LBE2:
  54              	.LBB3:
 150:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_MISO_GPIO_CLK_ENABLE();
  55              		.loc 1 150 0
  56 001c A369     		ldr	r3, [r4, #24]
  57 001e 43F00403 		orr	r3, r3, #4
  58 0022 A361     		str	r3, [r4, #24]
  59 0024 A369     		ldr	r3, [r4, #24]
  60 0026 03F00403 		and	r3, r3, #4
  61 002a 0293     		str	r3, [sp, #8]
  62 002c 029B     		ldr	r3, [sp, #8]
  63              	.LBE3:
  64              	.LBB4:
 151:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_MOSI_GPIO_CLK_ENABLE();
  65              		.loc 1 151 0
  66 002e A369     		ldr	r3, [r4, #24]
  67 0030 43F00403 		orr	r3, r3, #4
  68 0034 A361     		str	r3, [r4, #24]
  69 0036 A369     		ldr	r3, [r4, #24]
  70 0038 03F00403 		and	r3, r3, #4
  71 003c 0393     		str	r3, [sp, #12]
  72 003e 039B     		ldr	r3, [sp, #12]
  73              	.LBE4:
  74              	.LBB5:
 152:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CS_GPIO_CLK_ENABLE();
  75              		.loc 1 152 0
  76 0040 A369     		ldr	r3, [r4, #24]
  77 0042 43F00803 		orr	r3, r3, #8
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 5


  78 0046 A361     		str	r3, [r4, #24]
  79 0048 A369     		ldr	r3, [r4, #24]
  80 004a 03F00803 		and	r3, r3, #8
  81 004e 0493     		str	r3, [sp, #16]
  82 0050 049B     		ldr	r3, [sp, #16]
  83              	.LBE5:
 153:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 154:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/* Configure SPI SCLK */
 155:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	gpioinitstruct.Pin = SD_SCLK_PIN;
  84              		.loc 1 155 0
  85 0052 2023     		movs	r3, #32
  86 0054 0693     		str	r3, [sp, #24]
 156:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	gpioinitstruct.Mode = GPIO_MODE_AF_PP;
  87              		.loc 1 156 0
  88 0056 0227     		movs	r7, #2
  89 0058 0797     		str	r7, [sp, #28]
 157:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** // gpioinitstruct.Pull  = GPIO_PULLUP;
 158:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	gpioinitstruct.Speed = GPIO_SPEED_FREQ_HIGH;
  90              		.loc 1 158 0
  91 005a 0323     		movs	r3, #3
  92 005c 0993     		str	r3, [sp, #36]
 159:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** // gpioinitstruct.Alternate = SD_SCLK_AF;
 160:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	HAL_GPIO_Init(SD_SCLK_GPIO_PORT, &gpioinitstruct);
  93              		.loc 1 160 0
  94 005e 06A9     		add	r1, sp, #24
  95 0060 1048     		ldr	r0, .L3+4
  96 0062 FFF7FEFF 		bl	HAL_GPIO_Init
  97              	.LVL0:
 161:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 162:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/* Configure SPI MISO */
 163:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	gpioinitstruct.Pin = SD_MISO_PIN;
  98              		.loc 1 163 0
  99 0066 4023     		movs	r3, #64
 100 0068 0693     		str	r3, [sp, #24]
 164:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	gpioinitstruct.Mode = GPIO_MODE_INPUT;
 101              		.loc 1 164 0
 102 006a 0795     		str	r5, [sp, #28]
 165:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	gpioinitstruct.Pull  = GPIO_NOPULL;
 103              		.loc 1 165 0
 104 006c 0895     		str	r5, [sp, #32]
 166:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	HAL_GPIO_Init(SD_MISO_GPIO_PORT, &gpioinitstruct);
 105              		.loc 1 166 0
 106 006e 0E4E     		ldr	r6, .L3+8
 107 0070 06A9     		add	r1, sp, #24
 108 0072 3046     		mov	r0, r6
 109 0074 FFF7FEFF 		bl	HAL_GPIO_Init
 110              	.LVL1:
 167:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 168:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/* Configure SPI MOSI */
 169:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	gpioinitstruct.Pin = SD_MOSI_PIN;
 111              		.loc 1 169 0
 112 0078 8023     		movs	r3, #128
 113 007a 0693     		str	r3, [sp, #24]
 170:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	gpioinitstruct.Mode = GPIO_MODE_AF_PP;
 114              		.loc 1 170 0
 115 007c 0797     		str	r7, [sp, #28]
 171:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	gpioinitstruct.Pull  = GPIO_NOPULL;
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 6


 116              		.loc 1 171 0
 117 007e 0895     		str	r5, [sp, #32]
 172:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	HAL_GPIO_Init(SD_MOSI_GPIO_PORT, &gpioinitstruct);
 118              		.loc 1 172 0
 119 0080 06A9     		add	r1, sp, #24
 120 0082 3046     		mov	r0, r6
 121 0084 FFF7FEFF 		bl	HAL_GPIO_Init
 122              	.LVL2:
 123              	.LBB6:
 173:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 174:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/*** Configure the SPI peripheral ***/
 175:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/* Enable SPI clock */
 176:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_SPI_CLK_ENABLE();
 124              		.loc 1 176 0
 125 0088 A369     		ldr	r3, [r4, #24]
 126 008a 43F48053 		orr	r3, r3, #4096
 127 008e A361     		str	r3, [r4, #24]
 128 0090 A369     		ldr	r3, [r4, #24]
 129 0092 03F48053 		and	r3, r3, #4096
 130 0096 0593     		str	r3, [sp, #20]
 131 0098 059B     		ldr	r3, [sp, #20]
 132              	.LBE6:
 177:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 133              		.loc 1 177 0
 134 009a 0BB0     		add	sp, sp, #44
 135              	.LCFI2:
 136              		.cfi_def_cfa_offset 20
 137              		@ sp needed
 138 009c F0BD     		pop	{r4, r5, r6, r7, pc}
 139              	.L4:
 140 009e 00BF     		.align	2
 141              	.L3:
 142 00a0 00100240 		.word	1073876992
 143 00a4 000C0140 		.word	1073810432
 144 00a8 00080140 		.word	1073809408
 145              		.cfi_endproc
 146              	.LFE67:
 148              		.section	.text.SPIx_Init,"ax",%progbits
 149              		.align	1
 150              		.syntax unified
 151              		.thumb
 152              		.thumb_func
 153              		.fpu softvfp
 155              	SPIx_Init:
 156              	.LFB66:
 115:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (HAL_SPI_GetState(&SD_SPI_HANDLE) == HAL_SPI_STATE_RESET) {
 157              		.loc 1 115 0
 158              		.cfi_startproc
 159              		@ args = 0, pretend = 0, frame = 0
 160              		@ frame_needed = 0, uses_anonymous_args = 0
 161 0000 08B5     		push	{r3, lr}
 162              	.LCFI3:
 163              		.cfi_def_cfa_offset 8
 164              		.cfi_offset 3, -8
 165              		.cfi_offset 14, -4
 116:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SPIx_GPIO_Init();
 166              		.loc 1 116 0
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 7


 167 0002 0F48     		ldr	r0, .L9
 168 0004 FFF7FEFF 		bl	HAL_SPI_GetState
 169              	.LVL3:
 170 0008 00B1     		cbz	r0, .L8
 171              	.L5:
 141:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 172              		.loc 1 141 0
 173 000a 08BD     		pop	{r3, pc}
 174              	.L8:
 117:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		/* SPI Config */
 175              		.loc 1 117 0
 176 000c FFF7FEFF 		bl	SPIx_GPIO_Init
 177              	.LVL4:
 124:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_SPI_HANDLE.Init.CLKPhase = SPI_PHASE_2EDGE;
 178              		.loc 1 124 0
 179 0010 0B48     		ldr	r0, .L9
 180 0012 0823     		movs	r3, #8
 181 0014 C361     		str	r3, [r0, #28]
 125:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_SPI_HANDLE.Init.CLKPolarity = SPI_POLARITY_HIGH;
 182              		.loc 1 125 0
 183 0016 0123     		movs	r3, #1
 184 0018 4361     		str	r3, [r0, #20]
 126:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_SPI_HANDLE.Init.CRCCalculation = SPI_CRCCALCULATION_DISABLE;
 185              		.loc 1 126 0
 186 001a 0223     		movs	r3, #2
 187 001c 0361     		str	r3, [r0, #16]
 127:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** // SD_SPI_HANDLE.Init.CRCLength = SPI_CRC_LENGTH_DATASIZE;
 188              		.loc 1 127 0
 189 001e 0023     		movs	r3, #0
 190 0020 8362     		str	r3, [r0, #40]
 130:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_SPI_HANDLE.Init.Direction = SPI_DIRECTION_2LINES;
 191              		.loc 1 130 0
 192 0022 C360     		str	r3, [r0, #12]
 131:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_SPI_HANDLE.Init.FirstBit = SPI_FIRSTBIT_MSB;
 193              		.loc 1 131 0
 194 0024 8360     		str	r3, [r0, #8]
 132:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_SPI_HANDLE.Init.Mode = SPI_MODE_MASTER;
 195              		.loc 1 132 0
 196 0026 0362     		str	r3, [r0, #32]
 133:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_SPI_HANDLE.Init.NSS = SPI_NSS_SOFT;
 197              		.loc 1 133 0
 198 0028 4FF48272 		mov	r2, #260
 199 002c 4260     		str	r2, [r0, #4]
 134:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** // SD_SPI_HANDLE.Init.NSSPMode = SPI_NSS_PULSE_DISABLE;
 200              		.loc 1 134 0
 201 002e 4FF40072 		mov	r2, #512
 202 0032 8261     		str	r2, [r0, #24]
 136:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_SPI_HANDLE.Instance = SD_SPI_INSTANCE;
 203              		.loc 1 136 0
 204 0034 4362     		str	r3, [r0, #36]
 137:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 205              		.loc 1 137 0
 206 0036 034B     		ldr	r3, .L9+4
 207 0038 0360     		str	r3, [r0]
 139:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 208              		.loc 1 139 0
 209 003a FFF7FEFF 		bl	HAL_SPI_Init
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 8


 210              	.LVL5:
 141:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 211              		.loc 1 141 0
 212 003e E4E7     		b	.L5
 213              	.L10:
 214              		.align	2
 215              	.L9:
 216 0040 00000000 		.word	hspi1
 217 0044 00300140 		.word	1073819648
 218              		.cfi_endproc
 219              	.LFE66:
 221              		.section	.text.SPIx_Error,"ax",%progbits
 222              		.align	1
 223              		.syntax unified
 224              		.thumb
 225              		.thumb_func
 226              		.fpu softvfp
 228              	SPIx_Error:
 229              	.LFB71:
 178:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 179:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static void SPIx_WriteReadData(const uint8_t *DataIn, uint8_t *DataOut, uint16_t DataLength)
 180:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 181:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	HAL_StatusTypeDef status = HAL_OK;
 182:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 183:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	status = HAL_SPI_TransmitReceive(&SD_SPI_HANDLE, (uint8_t *) DataIn, DataOut, DataLength, SD_SPI_T
 184:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 185:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/* Check the communication status */
 186:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (status != HAL_OK) {
 187:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		/* Execute user timeout callback */
 188:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SPIx_Error();
 189:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 190:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 191:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 192:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static void SPIx_WriteData(uint8_t *DataIn, uint16_t DataLength)
 193:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 194:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	HAL_StatusTypeDef status = HAL_OK;
 195:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 196:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	status = HAL_SPI_Transmit(&SD_SPI_HANDLE, DataIn, DataLength, SD_SPI_TIMEOUT_MAX);
 197:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 198:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/* Check the communication status */
 199:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (status != HAL_OK) {
 200:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		/* Execute user timeout callback */
 201:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SPIx_Error();
 202:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 203:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 204:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 205:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static void SPIx_Write(uint8_t Value)
 206:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 207:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	HAL_StatusTypeDef status = HAL_OK;
 208:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t data;
 209:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 210:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	status = HAL_SPI_TransmitReceive(&SD_SPI_HANDLE, (uint8_t *) &Value, &data, 1, SD_SPI_TIMEOUT_MAX)
 211:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 212:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/* Check the communication status */
 213:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (status != HAL_OK) {
 214:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		/* Execute user timeout callback */
 215:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SPIx_Error();
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 9


 216:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 217:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 218:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 219:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static void SPIx_Error(void)
 220:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 230              		.loc 1 220 0
 231              		.cfi_startproc
 232              		@ args = 0, pretend = 0, frame = 0
 233              		@ frame_needed = 0, uses_anonymous_args = 0
 234 0000 08B5     		push	{r3, lr}
 235              	.LCFI4:
 236              		.cfi_def_cfa_offset 8
 237              		.cfi_offset 3, -8
 238              		.cfi_offset 14, -4
 221:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/* De-initialize the SPI communication BUS */
 222:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	HAL_SPI_DeInit(&SD_SPI_HANDLE);
 239              		.loc 1 222 0
 240 0002 0348     		ldr	r0, .L13
 241 0004 FFF7FEFF 		bl	HAL_SPI_DeInit
 242              	.LVL6:
 223:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 224:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/* Re-Initiaize the SPI communication BUS */
 225:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SPIx_Init();
 243              		.loc 1 225 0
 244 0008 FFF7FEFF 		bl	SPIx_Init
 245              	.LVL7:
 226:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 246              		.loc 1 226 0
 247 000c 08BD     		pop	{r3, pc}
 248              	.L14:
 249 000e 00BF     		.align	2
 250              	.L13:
 251 0010 00000000 		.word	hspi1
 252              		.cfi_endproc
 253              	.LFE71:
 255              		.section	.text.SPIx_WriteReadData,"ax",%progbits
 256              		.align	1
 257              		.syntax unified
 258              		.thumb
 259              		.thumb_func
 260              		.fpu softvfp
 262              	SPIx_WriteReadData:
 263              	.LFB68:
 180:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	HAL_StatusTypeDef status = HAL_OK;
 264              		.loc 1 180 0
 265              		.cfi_startproc
 266              		@ args = 0, pretend = 0, frame = 0
 267              		@ frame_needed = 0, uses_anonymous_args = 0
 268              	.LVL8:
 269 0000 00B5     		push	{lr}
 270              	.LCFI5:
 271              		.cfi_def_cfa_offset 4
 272              		.cfi_offset 14, -4
 273 0002 83B0     		sub	sp, sp, #12
 274              	.LCFI6:
 275              		.cfi_def_cfa_offset 16
 276              	.LVL9:
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 10


 183:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 277              		.loc 1 183 0
 278 0004 4FF47A73 		mov	r3, #1000
 279 0008 0093     		str	r3, [sp]
 280 000a 1346     		mov	r3, r2
 281 000c 0A46     		mov	r2, r1
 282              	.LVL10:
 283 000e 0146     		mov	r1, r0
 284              	.LVL11:
 285 0010 0448     		ldr	r0, .L19
 286              	.LVL12:
 287 0012 FFF7FEFF 		bl	HAL_SPI_TransmitReceive
 288              	.LVL13:
 186:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		/* Execute user timeout callback */
 289              		.loc 1 186 0
 290 0016 10B9     		cbnz	r0, .L18
 291              	.LVL14:
 292              	.L15:
 190:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 293              		.loc 1 190 0
 294 0018 03B0     		add	sp, sp, #12
 295              	.LCFI7:
 296              		.cfi_remember_state
 297              		.cfi_def_cfa_offset 4
 298              		@ sp needed
 299 001a 5DF804FB 		ldr	pc, [sp], #4
 300              	.LVL15:
 301              	.L18:
 302              	.LCFI8:
 303              		.cfi_restore_state
 188:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 304              		.loc 1 188 0
 305 001e FFF7FEFF 		bl	SPIx_Error
 306              	.LVL16:
 190:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 307              		.loc 1 190 0
 308 0022 F9E7     		b	.L15
 309              	.L20:
 310              		.align	2
 311              	.L19:
 312 0024 00000000 		.word	hspi1
 313              		.cfi_endproc
 314              	.LFE68:
 316              		.section	.text.SPIx_WriteData,"ax",%progbits
 317              		.align	1
 318              		.syntax unified
 319              		.thumb
 320              		.thumb_func
 321              		.fpu softvfp
 323              	SPIx_WriteData:
 324              	.LFB69:
 193:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	HAL_StatusTypeDef status = HAL_OK;
 325              		.loc 1 193 0
 326              		.cfi_startproc
 327              		@ args = 0, pretend = 0, frame = 0
 328              		@ frame_needed = 0, uses_anonymous_args = 0
 329              	.LVL17:
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 11


 330 0000 08B5     		push	{r3, lr}
 331              	.LCFI9:
 332              		.cfi_def_cfa_offset 8
 333              		.cfi_offset 3, -8
 334              		.cfi_offset 14, -4
 335              	.LVL18:
 196:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 336              		.loc 1 196 0
 337 0002 4FF47A73 		mov	r3, #1000
 338 0006 0A46     		mov	r2, r1
 339 0008 0146     		mov	r1, r0
 340              	.LVL19:
 341 000a 0448     		ldr	r0, .L25
 342              	.LVL20:
 343 000c FFF7FEFF 		bl	HAL_SPI_Transmit
 344              	.LVL21:
 199:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		/* Execute user timeout callback */
 345              		.loc 1 199 0
 346 0010 00B9     		cbnz	r0, .L24
 347              	.LVL22:
 348              	.L21:
 203:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 349              		.loc 1 203 0
 350 0012 08BD     		pop	{r3, pc}
 351              	.LVL23:
 352              	.L24:
 201:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 353              		.loc 1 201 0
 354 0014 FFF7FEFF 		bl	SPIx_Error
 355              	.LVL24:
 203:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 356              		.loc 1 203 0
 357 0018 FBE7     		b	.L21
 358              	.L26:
 359 001a 00BF     		.align	2
 360              	.L25:
 361 001c 00000000 		.word	hspi1
 362              		.cfi_endproc
 363              	.LFE69:
 365              		.section	.text.SPIx_FlushFifo,"ax",%progbits
 366              		.align	1
 367              		.syntax unified
 368              		.thumb
 369              		.thumb_func
 370              		.fpu softvfp
 372              	SPIx_FlushFifo:
 373              	.LFB72:
 227:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 228:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static void SPIx_FlushFifo(void)
 229:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 374              		.loc 1 229 0
 375              		.cfi_startproc
 376              		@ args = 0, pretend = 0, frame = 0
 377              		@ frame_needed = 0, uses_anonymous_args = 0
 378 0000 08B5     		push	{r3, lr}
 379              	.LCFI10:
 380              		.cfi_def_cfa_offset 8
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 12


 381              		.cfi_offset 3, -8
 382              		.cfi_offset 14, -4
 230:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	HAL_SPIEx_FlushRxFifo(&SD_SPI_HANDLE);
 383              		.loc 1 230 0
 384 0002 0248     		ldr	r0, .L29
 385 0004 FFF7FEFF 		bl	HAL_SPIEx_FlushRxFifo
 386              	.LVL25:
 231:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 387              		.loc 1 231 0
 388 0008 08BD     		pop	{r3, pc}
 389              	.L30:
 390 000a 00BF     		.align	2
 391              	.L29:
 392 000c 00000000 		.word	hspi1
 393              		.cfi_endproc
 394              	.LFE72:
 396              		.section	.text.SD_IO_WriteReadData,"ax",%progbits
 397              		.align	1
 398              		.global	SD_IO_WriteReadData
 399              		.syntax unified
 400              		.thumb
 401              		.thumb_func
 402              		.fpu softvfp
 404              	SD_IO_WriteReadData:
 405              	.LFB74:
 232:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 233:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** /********************************* LINK SD ************************************/
 234:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 235:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** void SD_IO_Init(void)
 236:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 237:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t counter = 0;
 238:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 239:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/*------------Put SD in SPI mode--------------*/
 240:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/* SD SPI Config */
 241:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SPIx_Init();
 242:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 243:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/* SD chip select high */
 244:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CS_HIGH();
 245:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 246:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/* Send dummy byte 0xFF, 10 times with CS high */
 247:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/* Rise CS and MOSI for 80 clocks cycles */
 248:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	for (counter = 0; counter <= 9; counter++) {
 249:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		/* Send dummy byte 0xFF */
 250:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_IO_WriteByte(SD_DUMMY_BYTE);
 251:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 252:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 253:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 254:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** void SD_IO_WriteReadData(const uint8_t *DataIn, uint8_t *DataOut, uint16_t DataLength)
 255:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 406              		.loc 1 255 0
 407              		.cfi_startproc
 408              		@ args = 0, pretend = 0, frame = 0
 409              		@ frame_needed = 0, uses_anonymous_args = 0
 410              	.LVL26:
 411 0000 08B5     		push	{r3, lr}
 412              	.LCFI11:
 413              		.cfi_def_cfa_offset 8
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 13


 414              		.cfi_offset 3, -8
 415              		.cfi_offset 14, -4
 256:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/* Send the byte */
 257:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SPIx_WriteReadData(DataIn, DataOut, DataLength);
 416              		.loc 1 257 0
 417 0002 FFF7FEFF 		bl	SPIx_WriteReadData
 418              	.LVL27:
 258:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 419              		.loc 1 258 0
 420 0006 08BD     		pop	{r3, pc}
 421              		.cfi_endproc
 422              	.LFE74:
 424              		.section	.text.SD_IO_WriteByte,"ax",%progbits
 425              		.align	1
 426              		.global	SD_IO_WriteByte
 427              		.syntax unified
 428              		.thumb
 429              		.thumb_func
 430              		.fpu softvfp
 432              	SD_IO_WriteByte:
 433              	.LFB75:
 259:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 260:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** uint8_t SD_IO_WriteByte(uint8_t Data)
 261:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 434              		.loc 1 261 0
 435              		.cfi_startproc
 436              		@ args = 0, pretend = 0, frame = 16
 437              		@ frame_needed = 0, uses_anonymous_args = 0
 438              	.LVL28:
 439 0000 00B5     		push	{lr}
 440              	.LCFI12:
 441              		.cfi_def_cfa_offset 4
 442              		.cfi_offset 14, -4
 443 0002 85B0     		sub	sp, sp, #20
 444              	.LCFI13:
 445              		.cfi_def_cfa_offset 24
 446 0004 8DF80700 		strb	r0, [sp, #7]
 262:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t tmp;
 263:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 264:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/* Send the byte */
 265:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SPIx_WriteReadData(&Data, &tmp, 1);
 447              		.loc 1 265 0
 448 0008 0122     		movs	r2, #1
 449 000a 0DF10F01 		add	r1, sp, #15
 450 000e 0DF10700 		add	r0, sp, #7
 451              	.LVL29:
 452 0012 FFF7FEFF 		bl	SPIx_WriteReadData
 453              	.LVL30:
 266:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	return tmp;
 267:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 454              		.loc 1 267 0
 455 0016 9DF80F00 		ldrb	r0, [sp, #15]	@ zero_extendqisi2
 456 001a 05B0     		add	sp, sp, #20
 457              	.LCFI14:
 458              		.cfi_def_cfa_offset 4
 459              		@ sp needed
 460 001c 5DF804FB 		ldr	pc, [sp], #4
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 14


 461              		.cfi_endproc
 462              	.LFE75:
 464              		.section	.text.SD_IO_Init,"ax",%progbits
 465              		.align	1
 466              		.global	SD_IO_Init
 467              		.syntax unified
 468              		.thumb
 469              		.thumb_func
 470              		.fpu softvfp
 472              	SD_IO_Init:
 473              	.LFB73:
 236:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t counter = 0;
 474              		.loc 1 236 0
 475              		.cfi_startproc
 476              		@ args = 0, pretend = 0, frame = 0
 477              		@ frame_needed = 0, uses_anonymous_args = 0
 478 0000 10B5     		push	{r4, lr}
 479              	.LCFI15:
 480              		.cfi_def_cfa_offset 8
 481              		.cfi_offset 4, -8
 482              		.cfi_offset 14, -4
 483              	.LVL31:
 241:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 484              		.loc 1 241 0
 485 0002 FFF7FEFF 		bl	SPIx_Init
 486              	.LVL32:
 244:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 487              		.loc 1 244 0
 488 0006 0122     		movs	r2, #1
 489 0008 2021     		movs	r1, #32
 490 000a 0648     		ldr	r0, .L39
 491 000c FFF7FEFF 		bl	HAL_GPIO_WritePin
 492              	.LVL33:
 248:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		/* Send dummy byte 0xFF */
 493              		.loc 1 248 0
 494 0010 0024     		movs	r4, #0
 495 0012 04E0     		b	.L36
 496              	.LVL34:
 497              	.L37:
 250:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 498              		.loc 1 250 0 discriminator 3
 499 0014 FF20     		movs	r0, #255
 500 0016 FFF7FEFF 		bl	SD_IO_WriteByte
 501              	.LVL35:
 248:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		/* Send dummy byte 0xFF */
 502              		.loc 1 248 0 discriminator 3
 503 001a 0134     		adds	r4, r4, #1
 504              	.LVL36:
 505 001c E4B2     		uxtb	r4, r4
 506              	.LVL37:
 507              	.L36:
 248:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		/* Send dummy byte 0xFF */
 508              		.loc 1 248 0 is_stmt 0 discriminator 1
 509 001e 092C     		cmp	r4, #9
 510 0020 F8D9     		bls	.L37
 252:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 511              		.loc 1 252 0 is_stmt 1
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 15


 512 0022 10BD     		pop	{r4, pc}
 513              	.LVL38:
 514              	.L40:
 515              		.align	2
 516              	.L39:
 517 0024 000C0140 		.word	1073810432
 518              		.cfi_endproc
 519              	.LFE73:
 521              		.section	.text.SD_ReadData,"ax",%progbits
 522              		.align	1
 523              		.syntax unified
 524              		.thumb
 525              		.thumb_func
 526              		.fpu softvfp
 528              	SD_ReadData:
 529              	.LFB86:
 268:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 269:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** void SD_IO_ReadData(uint8_t *DataOut, uint16_t DataLength)
 270:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 271:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/* Send the byte */
 272:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteReadData(DataOut, DataOut, DataLength);
 273:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 274:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 275:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** void SD_IO_WriteData(const uint8_t *Data, uint16_t DataLength)
 276:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 277:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/* Send the byte */
 278:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SPIx_WriteData((uint8_t *)Data, DataLength);
 279:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SPIx_FlushFifo();
 280:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 281:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 282:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** uint8_t BSP_SD_Init(void)
 283:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 284:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Configure IO functionalities for SD pin
 285:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_Init();
 286:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 287:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// SD detection pin is not physically mapped on the Adafruit shield
 288:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SdStatus = SD_PRESENT;
 289:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 290:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// SD initialized and set to SPI mode properly
 291:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	return SD_GoIdleState();
 292:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 293:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 294:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** uint8_t BSP_SD_ReadBlocks(uint32_t *pData, uint32_t ReadAddr, uint16_t BlockSize, uint32_t NumberOf
 295:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 296:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint32_t offset = 0;
 297:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t retr = BSP_SD_ERROR;
 298:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t *ptr = NULL;
 299:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CmdAnswer_typedef response;
 300:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 301:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Send CMD16 (SD_CMD_SET_BLOCKLEN) to set the size of the block and
 302:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Check if the SD acknowledged the set block length command: R1 response (0x00: no errors)
 303:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	response = SD_SendCmd(SD_CMD_SET_BLOCKLEN, BlockSize, 0xFF, SD_ANSWER_R1_EXPECTED);
 304:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CS_HIGH();
 305:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteByte(SD_DUMMY_BYTE);
 306:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (response.r1 != SD_R1_NO_ERROR) {
 307:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		goto error;
 308:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 16


 309:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 310:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	ptr = malloc(sizeof(uint8_t) * BlockSize);
 311:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (ptr == NULL) {
 312:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		goto error;
 313:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 314:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	memset(ptr, SD_DUMMY_BYTE, sizeof(uint8_t)*BlockSize);
 315:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 316:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Data transfer
 317:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	while (NumberOfBlocks--) {
 318:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Send CMD17 (SD_CMD_READ_SINGLE_BLOCK) to read one block
 319:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Check if the SD acknowledged the read block command: R1 response (0x00: no errors)
 320:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		response = SD_SendCmd(SD_CMD_READ_SINGLE_BLOCK, (ReadAddr + offset) / (flag_SDHC == 1 ? BlockSize
 321:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 							  SD_ANSWER_R1_EXPECTED);
 322:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		if (response.r1 != SD_R1_NO_ERROR) {
 323:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			goto error;
 324:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		}
 325:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 326:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Now look for the data token to signify the start of the data
 327:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		if (SD_WaitData(SD_TOKEN_START_DATA_SINGLE_BLOCK_READ) == BSP_SD_OK) {
 328:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Read the SD block data : read NumByteToRead data
 329:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_IO_WriteReadData(ptr, (uint8_t *)pData + offset, BlockSize);
 330:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 331:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Set next read address
 332:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			offset += BlockSize;
 333:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// get CRC bytes (not really needed by us, but required by SD)
 334:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_IO_WriteByte(SD_DUMMY_BYTE);
 335:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_IO_WriteByte(SD_DUMMY_BYTE);
 336:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		} else {
 337:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			goto error;
 338:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		}
 339:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 340:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// End the command data read cycle
 341:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_CS_HIGH();
 342:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_IO_WriteByte(SD_DUMMY_BYTE);
 343:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 344:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 345:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	retr = BSP_SD_OK;
 346:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 347:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** error :
 348:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Send dummy byte: 8 Clock pulses of delay
 349:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CS_HIGH();
 350:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteByte(SD_DUMMY_BYTE);
 351:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (ptr != NULL) {
 352:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		free(ptr);
 353:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 354:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 355:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Return the reponse
 356:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	return retr;
 357:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 358:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 359:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** uint8_t BSP_SD_WriteBlocks(uint32_t *pData, uint32_t WriteAddr, uint16_t BlockSize, uint32_t Number
 360:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 361:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint32_t offset = 0;
 362:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t retr = BSP_SD_ERROR;
 363:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t *ptr = NULL;
 364:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CmdAnswer_typedef response;
 365:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 17


 366:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Send CMD16 (SD_CMD_SET_BLOCKLEN) to set the size of the block and
 367:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Check if the SD acknowledged the set block length command: R1 response (0x00: no errors)
 368:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	response = SD_SendCmd(SD_CMD_SET_BLOCKLEN, BlockSize, 0xFF, SD_ANSWER_R1_EXPECTED);
 369:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CS_HIGH();
 370:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteByte(SD_DUMMY_BYTE);
 371:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (response.r1 != SD_R1_NO_ERROR) {
 372:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		goto error;
 373:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 374:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 375:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	ptr = malloc(sizeof(uint8_t) * BlockSize);
 376:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (ptr == NULL) {
 377:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		goto error;
 378:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 379:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 380:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Data transfer
 381:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	while (NumberOfBlocks--) {
 382:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Send CMD24 (SD_CMD_WRITE_SINGLE_BLOCK) to write blocks	and
 383:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Check if the SD acknowledged the write block command: R1 response (0x00: no errors)
 384:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		response = SD_SendCmd(SD_CMD_WRITE_SINGLE_BLOCK, (WriteAddr + offset) / (flag_SDHC == 1 ? BlockSi
 385:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 							  SD_ANSWER_R1_EXPECTED);
 386:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		if (response.r1 != SD_R1_NO_ERROR) {
 387:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			goto error;
 388:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		}
 389:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 390:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Send dummy byte for NWR timing : one byte between CMDWRITE and TOKEN
 391:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_IO_WriteByte(SD_DUMMY_BYTE);
 392:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_IO_WriteByte(SD_DUMMY_BYTE);
 393:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 394:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Send the data token to signify the start of the data
 395:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_IO_WriteByte(SD_TOKEN_START_DATA_SINGLE_BLOCK_WRITE);
 396:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 397:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Write the block data to SD
 398:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_IO_WriteReadData((uint8_t *)pData + offset, ptr, BlockSize);
 399:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 400:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Set next write address
 401:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		offset += BlockSize;
 402:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 403:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Put CRC bytes (not really needed by us, but required by SD)
 404:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_IO_WriteByte(SD_DUMMY_BYTE);
 405:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_IO_WriteByte(SD_DUMMY_BYTE);
 406:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 407:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Read data response
 408:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		if (SD_GetDataResponse() != SD_DATA_OK) {
 409:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Set response value to failure
 410:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			goto error;
 411:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		}
 412:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 413:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_CS_HIGH();
 414:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_IO_WriteByte(SD_DUMMY_BYTE);
 415:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 416:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	retr = BSP_SD_OK;
 417:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 418:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** error :
 419:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (ptr != NULL) {
 420:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		free(ptr);
 421:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 422:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Send dummy byte: 8 Clock pulses of delay
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 18


 423:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CS_HIGH();
 424:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteByte(SD_DUMMY_BYTE);
 425:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 426:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Return the reponse
 427:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	return retr;
 428:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 429:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 430:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** uint8_t BSP_SD_GetCardInfo(SD_CardInfo *pCardInfo)
 431:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 432:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t status;
 433:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 434:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	status = SD_GetCSDRegister(&(pCardInfo->Csd));
 435:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	status |= SD_GetCIDRegister(&(pCardInfo->Cid));
 436:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (flag_SDHC == 1) {
 437:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		pCardInfo->CardBlockSize = 512;
 438:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		pCardInfo->CardCapacity = (pCardInfo->Csd.version.v2.DeviceSize + 1) * pCardInfo->CardBlockSize;
 439:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	} else {
 440:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		pCardInfo->CardCapacity = (pCardInfo->Csd.version.v1.DeviceSize + 1) ;
 441:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		pCardInfo->CardCapacity *= (1 << (pCardInfo->Csd.version.v1.DeviceSizeMul + 2));
 442:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		pCardInfo->CardBlockSize = 1 << (pCardInfo->Csd.RdBlockLen);
 443:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		pCardInfo->CardCapacity *= pCardInfo->CardBlockSize;
 444:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 445:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 446:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	return status;
 447:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 448:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 449:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** uint8_t BSP_SD_GetStatus(void)
 450:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 451:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CmdAnswer_typedef retr;
 452:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 453:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Send CMD13 (SD_SEND_STATUS) to get SD status
 454:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	retr = SD_SendCmd(SD_CMD_SEND_STATUS, 0, 0xFF, SD_ANSWER_R2_EXPECTED);
 455:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CS_HIGH();
 456:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteByte(SD_DUMMY_BYTE);
 457:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 458:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Find SD status according to card state
 459:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if ((retr.r1 == SD_R1_NO_ERROR) && (retr.r2 == SD_R2_NO_ERROR)) {
 460:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		return BSP_SD_OK;
 461:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 462:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 463:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	return BSP_SD_ERROR;
 464:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 465:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 466:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** uint8_t BSP_SD_Erase(uint32_t StartAddr, uint32_t EndAddr)
 467:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 468:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t retr = BSP_SD_ERROR;
 469:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CmdAnswer_typedef response;
 470:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 471:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Send CMD32 (Erase group start) and check if the SD acknowledged the erase command: R1 response 
 472:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	response = SD_SendCmd(SD_CMD_SD_ERASE_GRP_START, StartAddr, 0xFF, SD_ANSWER_R1_EXPECTED);
 473:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CS_HIGH();
 474:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteByte(SD_DUMMY_BYTE);
 475:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (response.r1 == SD_R1_NO_ERROR) {
 476:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Send CMD33 (Erase group end) and Check if the SD acknowledged the erase command: R1 response (
 477:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		response = SD_SendCmd(SD_CMD_SD_ERASE_GRP_END, EndAddr, 0xFF, SD_ANSWER_R1_EXPECTED);
 478:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_CS_HIGH();
 479:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_IO_WriteByte(SD_DUMMY_BYTE);
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 19


 480:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		if (response.r1 == SD_R1_NO_ERROR) {
 481:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Send CMD38 (Erase) and Check if the SD acknowledged the erase command: R1 response (0x00: no 
 482:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			response = SD_SendCmd(SD_CMD_ERASE, 0, 0xFF, SD_ANSWER_R1B_EXPECTED);
 483:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			if (response.r1 == SD_R1_NO_ERROR) {
 484:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				retr = BSP_SD_OK;
 485:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			}
 486:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_CS_HIGH();
 487:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_IO_WriteByte(SD_DUMMY_BYTE);
 488:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		}
 489:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 490:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 491:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Return the reponse
 492:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	return retr;
 493:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 494:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 495:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static uint8_t SD_GoIdleState(void)
 496:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 497:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CmdAnswer_typedef response;
 498:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	volatile uint8_t counter = 0;
 499:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Send CMD0 (SD_CMD_GO_IDLE_STATE) to put SD in SPI mode and
 500:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// wait for In Idle State Response (R1 Format) equal to 0x01
 501:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	do {
 502:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		counter++;
 503:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		response = SD_SendCmd(SD_CMD_GO_IDLE_STATE, 0, 0x95, SD_ANSWER_R1_EXPECTED);
 504:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_CS_HIGH();
 505:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_IO_WriteByte(SD_DUMMY_BYTE);
 506:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		if (counter >= SD_MAX_TRY) {
 507:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			return BSP_SD_ERROR;
 508:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		}
 509:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	} while (response.r1 != SD_R1_IN_IDLE_STATE);
 510:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 511:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 512:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Send CMD8 (SD_CMD_SEND_IF_COND) to check the power supply status
 513:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// and wait until response (R7 Format) equal to 0xAA and
 514:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	response = SD_SendCmd(SD_CMD_SEND_IF_COND, 0x1AA, 0x87, SD_ANSWER_R7_EXPECTED);
 515:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CS_HIGH();
 516:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteByte(SD_DUMMY_BYTE);
 517:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if ((response.r1	& SD_R1_ILLEGAL_COMMAND) == SD_R1_ILLEGAL_COMMAND) {
 518:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// initialise card V1
 519:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		do {
 520:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// initialise card V1
 521:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Send CMD55 (SD_CMD_APP_CMD) before any ACMD command: R1 response (0x00: no errors)
 522:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			response = SD_SendCmd(SD_CMD_APP_CMD, 0x00000000, 0xFF, SD_ANSWER_R1_EXPECTED);
 523:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_CS_HIGH();
 524:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_IO_WriteByte(SD_DUMMY_BYTE);
 525:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 526:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Send ACMD41 (SD_CMD_SD_APP_OP_COND) to initialize SDHC or SDXC cards: R1 response (0x00: no e
 527:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			response = SD_SendCmd(SD_CMD_SD_APP_OP_COND, 0x00000000, 0xFF, SD_ANSWER_R1_EXPECTED);
 528:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_CS_HIGH();
 529:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_IO_WriteByte(SD_DUMMY_BYTE);
 530:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		} while (response.r1 == SD_R1_IN_IDLE_STATE);
 531:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		flag_SDHC = 0;
 532:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	} else if (response.r1 == SD_R1_IN_IDLE_STATE) {
 533:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// initialise card V2
 534:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		do {
 535:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 536:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Send CMD55 (SD_CMD_APP_CMD) before any ACMD command: R1 response (0x00: no errors)
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 20


 537:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			response = SD_SendCmd(SD_CMD_APP_CMD, 0, 0xFF, SD_ANSWER_R1_EXPECTED);
 538:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_CS_HIGH();
 539:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_IO_WriteByte(SD_DUMMY_BYTE);
 540:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 541:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Send ACMD41 (SD_CMD_SD_APP_OP_COND) to initialize SDHC or SDXC cards: R1 response (0x00: no e
 542:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			response = SD_SendCmd(SD_CMD_SD_APP_OP_COND, 0x40000000, 0xFF, SD_ANSWER_R1_EXPECTED);
 543:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_CS_HIGH();
 544:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_IO_WriteByte(SD_DUMMY_BYTE);
 545:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		} while (response.r1 == SD_R1_IN_IDLE_STATE);
 546:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 547:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		if ((response.r1 & SD_R1_ILLEGAL_COMMAND) == SD_R1_ILLEGAL_COMMAND) {
 548:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			do {
 549:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				// Send CMD55 (SD_CMD_APP_CMD) before any ACMD command: R1 response (0x00: no errors)
 550:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				response = SD_SendCmd(SD_CMD_APP_CMD, 0, 0xFF, SD_ANSWER_R1_EXPECTED);
 551:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				SD_CS_HIGH();
 552:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				SD_IO_WriteByte(SD_DUMMY_BYTE);
 553:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				if (response.r1 != SD_R1_IN_IDLE_STATE) {
 554:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 					return BSP_SD_ERROR;
 555:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				}
 556:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				// Send ACMD41 (SD_CMD_SD_APP_OP_COND) to initialize SDHC or SDXC cards: R1 response (0x00: no 
 557:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				response = SD_SendCmd(SD_CMD_SD_APP_OP_COND, 0x00000000, 0xFF, SD_ANSWER_R1_EXPECTED);
 558:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				SD_CS_HIGH();
 559:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				SD_IO_WriteByte(SD_DUMMY_BYTE);
 560:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			} while (response.r1 == SD_R1_IN_IDLE_STATE);
 561:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		}
 562:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 563:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Send CMD58 (SD_CMD_READ_OCR) to initialize SDHC or SDXC cards: R3 response (0x00: no errors)
 564:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		response = SD_SendCmd(SD_CMD_READ_OCR, 0x00000000, 0xFF, SD_ANSWER_R3_EXPECTED);
 565:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_CS_HIGH();
 566:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_IO_WriteByte(SD_DUMMY_BYTE);
 567:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		if (response.r1 != SD_R1_NO_ERROR) {
 568:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			return BSP_SD_ERROR;
 569:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		}
 570:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		flag_SDHC = (response.r2 & 0x40) >> 6;
 571:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	} else {
 572:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		return BSP_SD_ERROR;
 573:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 574:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 575:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	return BSP_SD_OK;
 576:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 577:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 578:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static SD_CmdAnswer_typedef SD_SendCmd(uint8_t Cmd, uint32_t Arg, uint8_t Crc, uint8_t Answer)
 579:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 580:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t frame[SD_CMD_LENGTH], frameout[SD_CMD_LENGTH];
 581:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CmdAnswer_typedef retr = {0xFF, 0xFF, 0xFF, 0xFF, 0xFF};
 582:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 583:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// R1 Lenght = NCS(0)+ 6 Bytes command + NCR(min1 max8) + 1 Bytes answer + NEC(0) = 15bytes
 584:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// R1b identical to R1 + Busy information
 585:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// R2 Lenght = NCS(0)+ 6 Bytes command + NCR(min1 max8) + 2 Bytes answer + NEC(0) = 16bytes
 586:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 587:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Prepare Frame to send
 588:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	frame[0] = (Cmd | 0x40);				 // Construct byte 1
 589:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	frame[1] = (uint8_t)(Arg >> 24); // Construct byte 2
 590:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	frame[2] = (uint8_t)(Arg >> 16); // Construct byte 3
 591:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	frame[3] = (uint8_t)(Arg >> 8);	// Construct byte 4
 592:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	frame[4] = (uint8_t)(Arg);			 // Construct byte 5
 593:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	frame[5] = (Crc | 0x01);				 // Construct byte 6
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 21


 594:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 595:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Send the command
 596:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CS_LOW();
 597:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteReadData(frame, frameout, SD_CMD_LENGTH); // Send the Cmd bytes
 598:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 599:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	switch (Answer) {
 600:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	case SD_ANSWER_R1_EXPECTED :
 601:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		retr.r1 = SD_ReadData();
 602:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		break;
 603:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	case SD_ANSWER_R1B_EXPECTED :
 604:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		retr.r1 = SD_ReadData();
 605:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		retr.r2 = SD_IO_WriteByte(SD_DUMMY_BYTE);
 606:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Set CS High
 607:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_CS_HIGH();
 608:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		HAL_Delay(1);
 609:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Set CS Low
 610:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_CS_LOW();
 611:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 612:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Wait IO line return 0xFF
 613:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		while (SD_IO_WriteByte(SD_DUMMY_BYTE) != 0xFF);
 614:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		break;
 615:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	case SD_ANSWER_R2_EXPECTED :
 616:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		retr.r1 = SD_ReadData();
 617:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		retr.r2 = SD_IO_WriteByte(SD_DUMMY_BYTE);
 618:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		break;
 619:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	case SD_ANSWER_R3_EXPECTED :
 620:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	case SD_ANSWER_R7_EXPECTED :
 621:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		retr.r1 = SD_ReadData();
 622:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		retr.r2 = SD_IO_WriteByte(SD_DUMMY_BYTE);
 623:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		retr.r3 = SD_IO_WriteByte(SD_DUMMY_BYTE);
 624:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		retr.r4 = SD_IO_WriteByte(SD_DUMMY_BYTE);
 625:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		retr.r5 = SD_IO_WriteByte(SD_DUMMY_BYTE);
 626:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		break;
 627:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	default :
 628:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		break;
 629:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 630:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	return retr;
 631:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 632:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 633:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static uint8_t SD_ReadData(void)
 634:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 530              		.loc 1 634 0
 531              		.cfi_startproc
 532              		@ args = 0, pretend = 0, frame = 0
 533              		@ frame_needed = 0, uses_anonymous_args = 0
 534 0000 10B5     		push	{r4, lr}
 535              	.LCFI16:
 536              		.cfi_def_cfa_offset 8
 537              		.cfi_offset 4, -8
 538              		.cfi_offset 14, -4
 539              	.LVL39:
 635:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t timeout = 0x08;
 540              		.loc 1 635 0
 541 0002 0824     		movs	r4, #8
 542              	.LVL40:
 543              	.L43:
 636:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t readvalue;
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 22


 637:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 638:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Check if response is got or a timeout is happen
 639:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	do {
 640:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		readvalue = SD_IO_WriteByte(SD_DUMMY_BYTE);
 544              		.loc 1 640 0 discriminator 2
 545 0004 FF20     		movs	r0, #255
 546 0006 FFF7FEFF 		bl	SD_IO_WriteByte
 547              	.LVL41:
 641:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		timeout--;
 548              		.loc 1 641 0 discriminator 2
 549 000a 013C     		subs	r4, r4, #1
 550              	.LVL42:
 551 000c E4B2     		uxtb	r4, r4
 552              	.LVL43:
 642:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 643:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	} while ((readvalue == SD_DUMMY_BYTE) && timeout);
 553              		.loc 1 643 0 discriminator 2
 554 000e FF28     		cmp	r0, #255
 555 0010 01D1     		bne	.L42
 556              		.loc 1 643 0 is_stmt 0 discriminator 1
 557 0012 002C     		cmp	r4, #0
 558 0014 F6D1     		bne	.L43
 559              	.L42:
 644:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 645:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Right response got
 646:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	return readvalue;
 647:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 560              		.loc 1 647 0 is_stmt 1
 561 0016 10BD     		pop	{r4, pc}
 562              		.cfi_endproc
 563              	.LFE86:
 565              		.section	.text.SD_SendCmd,"ax",%progbits
 566              		.align	1
 567              		.syntax unified
 568              		.thumb
 569              		.thumb_func
 570              		.fpu softvfp
 572              	SD_SendCmd:
 573              	.LFB85:
 579:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t frame[SD_CMD_LENGTH], frameout[SD_CMD_LENGTH];
 574              		.loc 1 579 0
 575              		.cfi_startproc
 576              		@ args = 4, pretend = 0, frame = 16
 577              		@ frame_needed = 0, uses_anonymous_args = 0
 578              	.LVL44:
 579 0000 70B5     		push	{r4, r5, r6, lr}
 580              	.LCFI17:
 581              		.cfi_def_cfa_offset 16
 582              		.cfi_offset 4, -16
 583              		.cfi_offset 5, -12
 584              		.cfi_offset 6, -8
 585              		.cfi_offset 14, -4
 586 0002 84B0     		sub	sp, sp, #16
 587              	.LCFI18:
 588              		.cfi_def_cfa_offset 32
 589 0004 0446     		mov	r4, r0
 590 0006 9DF82050 		ldrb	r5, [sp, #32]	@ zero_extendqisi2
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 23


 581:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 591              		.loc 1 581 0
 592 000a 344E     		ldr	r6, .L54
 593 000c 3068     		ldr	r0, [r6]
 594              	.LVL45:
 595 000e 2060     		str	r0, [r4]	@ unaligned
 596 0010 3079     		ldrb	r0, [r6, #4]	@ zero_extendqisi2
 597 0012 2071     		strb	r0, [r4, #4]
 588:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	frame[1] = (uint8_t)(Arg >> 24); // Construct byte 2
 598              		.loc 1 588 0
 599 0014 41F04001 		orr	r1, r1, #64
 600              	.LVL46:
 601 0018 8DF80810 		strb	r1, [sp, #8]
 589:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	frame[2] = (uint8_t)(Arg >> 16); // Construct byte 3
 602              		.loc 1 589 0
 603 001c 110E     		lsrs	r1, r2, #24
 604 001e 8DF80910 		strb	r1, [sp, #9]
 590:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	frame[3] = (uint8_t)(Arg >> 8);	// Construct byte 4
 605              		.loc 1 590 0
 606 0022 C2F30741 		ubfx	r1, r2, #16, #8
 607 0026 8DF80A10 		strb	r1, [sp, #10]
 591:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	frame[4] = (uint8_t)(Arg);			 // Construct byte 5
 608              		.loc 1 591 0
 609 002a C2F30721 		ubfx	r1, r2, #8, #8
 610 002e 8DF80B10 		strb	r1, [sp, #11]
 592:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	frame[5] = (Crc | 0x01);				 // Construct byte 6
 611              		.loc 1 592 0
 612 0032 8DF80C20 		strb	r2, [sp, #12]
 593:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 613              		.loc 1 593 0
 614 0036 43F00103 		orr	r3, r3, #1
 615              	.LVL47:
 616 003a 8DF80D30 		strb	r3, [sp, #13]
 596:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteReadData(frame, frameout, SD_CMD_LENGTH); // Send the Cmd bytes
 617              		.loc 1 596 0
 618 003e 0022     		movs	r2, #0
 619              	.LVL48:
 620 0040 2021     		movs	r1, #32
 621 0042 2748     		ldr	r0, .L54+4
 622 0044 FFF7FEFF 		bl	HAL_GPIO_WritePin
 623              	.LVL49:
 597:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 624              		.loc 1 597 0
 625 0048 0622     		movs	r2, #6
 626 004a 6946     		mov	r1, sp
 627 004c 02A8     		add	r0, sp, #8
 628 004e FFF7FEFF 		bl	SD_IO_WriteReadData
 629              	.LVL50:
 599:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	case SD_ANSWER_R1_EXPECTED :
 630              		.loc 1 599 0
 631 0052 052D     		cmp	r5, #5
 632 0054 07D8     		bhi	.L45
 633 0056 DFE805F0 		tbb	[pc, r5]
 634              	.L48:
 635 005a 03       		.byte	(.L47-.L48)/2
 636 005b 09       		.byte	(.L49-.L48)/2
 637 005c 24       		.byte	(.L50-.L48)/2
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 24


 638 005d 2C       		.byte	(.L51-.L48)/2
 639 005e 06       		.byte	(.L45-.L48)/2
 640 005f 2C       		.byte	(.L51-.L48)/2
 641              		.p2align 1
 642              	.L47:
 601:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		break;
 643              		.loc 1 601 0
 644 0060 FFF7FEFF 		bl	SD_ReadData
 645              	.LVL51:
 646 0064 2070     		strb	r0, [r4]
 647              	.L45:
 631:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 648              		.loc 1 631 0
 649 0066 2046     		mov	r0, r4
 650 0068 04B0     		add	sp, sp, #16
 651              	.LCFI19:
 652              		.cfi_remember_state
 653              		.cfi_def_cfa_offset 16
 654              		@ sp needed
 655 006a 70BD     		pop	{r4, r5, r6, pc}
 656              	.LVL52:
 657              	.L49:
 658              	.LCFI20:
 659              		.cfi_restore_state
 604:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		retr.r2 = SD_IO_WriteByte(SD_DUMMY_BYTE);
 660              		.loc 1 604 0
 661 006c FFF7FEFF 		bl	SD_ReadData
 662              	.LVL53:
 663 0070 2070     		strb	r0, [r4]
 605:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Set CS High
 664              		.loc 1 605 0
 665 0072 FF20     		movs	r0, #255
 666 0074 FFF7FEFF 		bl	SD_IO_WriteByte
 667              	.LVL54:
 668 0078 6070     		strb	r0, [r4, #1]
 607:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		HAL_Delay(1);
 669              		.loc 1 607 0
 670 007a 194D     		ldr	r5, .L54+4
 671 007c 0122     		movs	r2, #1
 672 007e 2021     		movs	r1, #32
 673 0080 2846     		mov	r0, r5
 674 0082 FFF7FEFF 		bl	HAL_GPIO_WritePin
 675              	.LVL55:
 608:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Set CS Low
 676              		.loc 1 608 0
 677 0086 0120     		movs	r0, #1
 678 0088 FFF7FEFF 		bl	HAL_Delay
 679              	.LVL56:
 610:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 680              		.loc 1 610 0
 681 008c 0022     		movs	r2, #0
 682 008e 2021     		movs	r1, #32
 683 0090 2846     		mov	r0, r5
 684 0092 FFF7FEFF 		bl	HAL_GPIO_WritePin
 685              	.LVL57:
 686              	.L52:
 613:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		break;
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 25


 687              		.loc 1 613 0 discriminator 1
 688 0096 FF20     		movs	r0, #255
 689 0098 FFF7FEFF 		bl	SD_IO_WriteByte
 690              	.LVL58:
 691 009c FF28     		cmp	r0, #255
 692 009e FAD1     		bne	.L52
 693 00a0 E1E7     		b	.L45
 694              	.L50:
 616:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		retr.r2 = SD_IO_WriteByte(SD_DUMMY_BYTE);
 695              		.loc 1 616 0
 696 00a2 FFF7FEFF 		bl	SD_ReadData
 697              	.LVL59:
 698 00a6 2070     		strb	r0, [r4]
 617:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		break;
 699              		.loc 1 617 0
 700 00a8 FF20     		movs	r0, #255
 701 00aa FFF7FEFF 		bl	SD_IO_WriteByte
 702              	.LVL60:
 703 00ae 6070     		strb	r0, [r4, #1]
 618:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	case SD_ANSWER_R3_EXPECTED :
 704              		.loc 1 618 0
 705 00b0 D9E7     		b	.L45
 706              	.L51:
 621:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		retr.r2 = SD_IO_WriteByte(SD_DUMMY_BYTE);
 707              		.loc 1 621 0
 708 00b2 FFF7FEFF 		bl	SD_ReadData
 709              	.LVL61:
 710 00b6 2070     		strb	r0, [r4]
 622:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		retr.r3 = SD_IO_WriteByte(SD_DUMMY_BYTE);
 711              		.loc 1 622 0
 712 00b8 FF20     		movs	r0, #255
 713 00ba FFF7FEFF 		bl	SD_IO_WriteByte
 714              	.LVL62:
 715 00be 6070     		strb	r0, [r4, #1]
 623:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		retr.r4 = SD_IO_WriteByte(SD_DUMMY_BYTE);
 716              		.loc 1 623 0
 717 00c0 FF20     		movs	r0, #255
 718 00c2 FFF7FEFF 		bl	SD_IO_WriteByte
 719              	.LVL63:
 720 00c6 A070     		strb	r0, [r4, #2]
 624:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		retr.r5 = SD_IO_WriteByte(SD_DUMMY_BYTE);
 721              		.loc 1 624 0
 722 00c8 FF20     		movs	r0, #255
 723 00ca FFF7FEFF 		bl	SD_IO_WriteByte
 724              	.LVL64:
 725 00ce E070     		strb	r0, [r4, #3]
 625:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		break;
 726              		.loc 1 625 0
 727 00d0 FF20     		movs	r0, #255
 728 00d2 FFF7FEFF 		bl	SD_IO_WriteByte
 729              	.LVL65:
 730 00d6 2071     		strb	r0, [r4, #4]
 630:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 731              		.loc 1 630 0
 732 00d8 C5E7     		b	.L45
 733              	.L55:
 734 00da 00BF     		.align	2
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 26


 735              	.L54:
 736 00dc 00000000 		.word	.LANCHOR0
 737 00e0 000C0140 		.word	1073810432
 738              		.cfi_endproc
 739              	.LFE85:
 741              		.section	.text.SD_GoIdleState,"ax",%progbits
 742              		.align	1
 743              		.syntax unified
 744              		.thumb
 745              		.thumb_func
 746              		.fpu softvfp
 748              	SD_GoIdleState:
 749              	.LFB84:
 496:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CmdAnswer_typedef response;
 750              		.loc 1 496 0
 751              		.cfi_startproc
 752              		@ args = 0, pretend = 0, frame = 24
 753              		@ frame_needed = 0, uses_anonymous_args = 0
 754 0000 70B5     		push	{r4, r5, r6, lr}
 755              	.LCFI21:
 756              		.cfi_def_cfa_offset 16
 757              		.cfi_offset 4, -16
 758              		.cfi_offset 5, -12
 759              		.cfi_offset 6, -8
 760              		.cfi_offset 14, -4
 761 0002 88B0     		sub	sp, sp, #32
 762              	.LCFI22:
 763              		.cfi_def_cfa_offset 48
 498:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Send CMD0 (SD_CMD_GO_IDLE_STATE) to put SD in SPI mode and
 764              		.loc 1 498 0
 765 0004 0023     		movs	r3, #0
 766 0006 8DF81730 		strb	r3, [sp, #23]
 767              	.L58:
 502:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		response = SD_SendCmd(SD_CMD_GO_IDLE_STATE, 0, 0x95, SD_ANSWER_R1_EXPECTED);
 768              		.loc 1 502 0
 769 000a 9DF81730 		ldrb	r3, [sp, #23]	@ zero_extendqisi2
 770 000e 0133     		adds	r3, r3, #1
 771 0010 DBB2     		uxtb	r3, r3
 772 0012 8DF81730 		strb	r3, [sp, #23]
 503:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_CS_HIGH();
 773              		.loc 1 503 0
 774 0016 0021     		movs	r1, #0
 775 0018 0091     		str	r1, [sp]
 776 001a 9523     		movs	r3, #149
 777 001c 0A46     		mov	r2, r1
 778 001e 06A8     		add	r0, sp, #24
 779 0020 FFF7FEFF 		bl	SD_SendCmd
 780              	.LVL66:
 504:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_IO_WriteByte(SD_DUMMY_BYTE);
 781              		.loc 1 504 0
 782 0024 0122     		movs	r2, #1
 783 0026 2021     		movs	r1, #32
 784 0028 6548     		ldr	r0, .L68
 785 002a FFF7FEFF 		bl	HAL_GPIO_WritePin
 786              	.LVL67:
 505:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		if (counter >= SD_MAX_TRY) {
 787              		.loc 1 505 0
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 27


 788 002e FF20     		movs	r0, #255
 789 0030 FFF7FEFF 		bl	SD_IO_WriteByte
 790              	.LVL68:
 506:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			return BSP_SD_ERROR;
 791              		.loc 1 506 0
 792 0034 9DF81730 		ldrb	r3, [sp, #23]	@ zero_extendqisi2
 793 0038 DBB2     		uxtb	r3, r3
 794 003a 632B     		cmp	r3, #99
 795 003c 00F2B880 		bhi	.L64
 509:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 796              		.loc 1 509 0
 797 0040 9DF81840 		ldrb	r4, [sp, #24]	@ zero_extendqisi2
 798 0044 012C     		cmp	r4, #1
 799 0046 E0D1     		bne	.L58
 514:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CS_HIGH();
 800              		.loc 1 514 0
 801 0048 0523     		movs	r3, #5
 802 004a 0093     		str	r3, [sp]
 803 004c 8723     		movs	r3, #135
 804 004e 4FF4D572 		mov	r2, #426
 805 0052 0821     		movs	r1, #8
 806 0054 0DEB0100 		add	r0, sp, r1
 807 0058 FFF7FEFF 		bl	SD_SendCmd
 808              	.LVL69:
 809 005c 0298     		ldr	r0, [sp, #8]	@ unaligned
 810 005e 0690     		str	r0, [sp, #24]
 515:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteByte(SD_DUMMY_BYTE);
 811              		.loc 1 515 0
 812 0060 0122     		movs	r2, #1
 813 0062 2021     		movs	r1, #32
 814 0064 5648     		ldr	r0, .L68
 815 0066 FFF7FEFF 		bl	HAL_GPIO_WritePin
 816              	.LVL70:
 516:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if ((response.r1	& SD_R1_ILLEGAL_COMMAND) == SD_R1_ILLEGAL_COMMAND) {
 817              		.loc 1 516 0
 818 006a FF20     		movs	r0, #255
 819 006c FFF7FEFF 		bl	SD_IO_WriteByte
 820              	.LVL71:
 517:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// initialise card V1
 821              		.loc 1 517 0
 822 0070 9DF81860 		ldrb	r6, [sp, #24]	@ zero_extendqisi2
 823 0074 16F0040F 		tst	r6, #4
 824 0078 28D0     		beq	.L59
 825              	.L60:
 522:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_CS_HIGH();
 826              		.loc 1 522 0 discriminator 1
 827 007a 0024     		movs	r4, #0
 828 007c 0094     		str	r4, [sp]
 829 007e FF23     		movs	r3, #255
 830 0080 2246     		mov	r2, r4
 831 0082 3721     		movs	r1, #55
 832 0084 02A8     		add	r0, sp, #8
 833 0086 FFF7FEFF 		bl	SD_SendCmd
 834              	.LVL72:
 523:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_IO_WriteByte(SD_DUMMY_BYTE);
 835              		.loc 1 523 0 discriminator 1
 836 008a 4D4D     		ldr	r5, .L68
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 28


 837 008c 0122     		movs	r2, #1
 838 008e 2021     		movs	r1, #32
 839 0090 2846     		mov	r0, r5
 840 0092 FFF7FEFF 		bl	HAL_GPIO_WritePin
 841              	.LVL73:
 524:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 842              		.loc 1 524 0 discriminator 1
 843 0096 FF20     		movs	r0, #255
 844 0098 FFF7FEFF 		bl	SD_IO_WriteByte
 845              	.LVL74:
 527:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_CS_HIGH();
 846              		.loc 1 527 0 discriminator 1
 847 009c 0094     		str	r4, [sp]
 848 009e FF23     		movs	r3, #255
 849 00a0 2246     		mov	r2, r4
 850 00a2 2921     		movs	r1, #41
 851 00a4 02A8     		add	r0, sp, #8
 852 00a6 FFF7FEFF 		bl	SD_SendCmd
 853              	.LVL75:
 854 00aa 0298     		ldr	r0, [sp, #8]	@ unaligned
 855 00ac 0690     		str	r0, [sp, #24]
 528:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_IO_WriteByte(SD_DUMMY_BYTE);
 856              		.loc 1 528 0 discriminator 1
 857 00ae 0122     		movs	r2, #1
 858 00b0 2021     		movs	r1, #32
 859 00b2 2846     		mov	r0, r5
 860 00b4 FFF7FEFF 		bl	HAL_GPIO_WritePin
 861              	.LVL76:
 529:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		} while (response.r1 == SD_R1_IN_IDLE_STATE);
 862              		.loc 1 529 0 discriminator 1
 863 00b8 FF20     		movs	r0, #255
 864 00ba FFF7FEFF 		bl	SD_IO_WriteByte
 865              	.LVL77:
 530:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		flag_SDHC = 0;
 866              		.loc 1 530 0 discriminator 1
 867 00be 9DF81830 		ldrb	r3, [sp, #24]	@ zero_extendqisi2
 868 00c2 012B     		cmp	r3, #1
 869 00c4 D9D0     		beq	.L60
 531:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	} else if (response.r1 == SD_R1_IN_IDLE_STATE) {
 870              		.loc 1 531 0
 871 00c6 3F4B     		ldr	r3, .L68+4
 872 00c8 1C80     		strh	r4, [r3]	@ movhi
 873 00ca 72E0     		b	.L57
 874              	.L59:
 532:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// initialise card V2
 875              		.loc 1 532 0
 876 00cc 012E     		cmp	r6, #1
 877 00ce 70D1     		bne	.L57
 878              	.L61:
 537:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_CS_HIGH();
 879              		.loc 1 537 0 discriminator 1
 880 00d0 0024     		movs	r4, #0
 881 00d2 0094     		str	r4, [sp]
 882 00d4 FF23     		movs	r3, #255
 883 00d6 2246     		mov	r2, r4
 884 00d8 3721     		movs	r1, #55
 885 00da 02A8     		add	r0, sp, #8
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 29


 886 00dc FFF7FEFF 		bl	SD_SendCmd
 887              	.LVL78:
 538:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_IO_WriteByte(SD_DUMMY_BYTE);
 888              		.loc 1 538 0 discriminator 1
 889 00e0 374D     		ldr	r5, .L68
 890 00e2 0122     		movs	r2, #1
 891 00e4 2021     		movs	r1, #32
 892 00e6 2846     		mov	r0, r5
 893 00e8 FFF7FEFF 		bl	HAL_GPIO_WritePin
 894              	.LVL79:
 539:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 895              		.loc 1 539 0 discriminator 1
 896 00ec FF20     		movs	r0, #255
 897 00ee FFF7FEFF 		bl	SD_IO_WriteByte
 898              	.LVL80:
 542:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_CS_HIGH();
 899              		.loc 1 542 0 discriminator 1
 900 00f2 0094     		str	r4, [sp]
 901 00f4 FF23     		movs	r3, #255
 902 00f6 4FF08042 		mov	r2, #1073741824
 903 00fa 2921     		movs	r1, #41
 904 00fc 02A8     		add	r0, sp, #8
 905 00fe FFF7FEFF 		bl	SD_SendCmd
 906              	.LVL81:
 907 0102 0298     		ldr	r0, [sp, #8]	@ unaligned
 908 0104 0690     		str	r0, [sp, #24]
 543:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_IO_WriteByte(SD_DUMMY_BYTE);
 909              		.loc 1 543 0 discriminator 1
 910 0106 0122     		movs	r2, #1
 911 0108 2021     		movs	r1, #32
 912 010a 2846     		mov	r0, r5
 913 010c FFF7FEFF 		bl	HAL_GPIO_WritePin
 914              	.LVL82:
 544:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		} while (response.r1 == SD_R1_IN_IDLE_STATE);
 915              		.loc 1 544 0 discriminator 1
 916 0110 FF20     		movs	r0, #255
 917 0112 FFF7FEFF 		bl	SD_IO_WriteByte
 918              	.LVL83:
 545:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 919              		.loc 1 545 0 discriminator 1
 920 0116 9DF81830 		ldrb	r3, [sp, #24]	@ zero_extendqisi2
 921 011a 012B     		cmp	r3, #1
 922 011c D8D0     		beq	.L61
 547:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			do {
 923              		.loc 1 547 0
 924 011e 13F0040F 		tst	r3, #4
 925 0122 29D0     		beq	.L62
 926              	.L63:
 550:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				SD_CS_HIGH();
 927              		.loc 1 550 0
 928 0124 0022     		movs	r2, #0
 929 0126 0092     		str	r2, [sp]
 930 0128 FF23     		movs	r3, #255
 931 012a 3721     		movs	r1, #55
 932 012c 02A8     		add	r0, sp, #8
 933 012e FFF7FEFF 		bl	SD_SendCmd
 934              	.LVL84:
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 30


 935 0132 0298     		ldr	r0, [sp, #8]	@ unaligned
 936 0134 0690     		str	r0, [sp, #24]
 551:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				SD_IO_WriteByte(SD_DUMMY_BYTE);
 937              		.loc 1 551 0
 938 0136 0122     		movs	r2, #1
 939 0138 2021     		movs	r1, #32
 940 013a 2148     		ldr	r0, .L68
 941 013c FFF7FEFF 		bl	HAL_GPIO_WritePin
 942              	.LVL85:
 552:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				if (response.r1 != SD_R1_IN_IDLE_STATE) {
 943              		.loc 1 552 0
 944 0140 FF20     		movs	r0, #255
 945 0142 FFF7FEFF 		bl	SD_IO_WriteByte
 946              	.LVL86:
 553:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 					return BSP_SD_ERROR;
 947              		.loc 1 553 0
 948 0146 9DF81830 		ldrb	r3, [sp, #24]	@ zero_extendqisi2
 949 014a 012B     		cmp	r3, #1
 950 014c 34D1     		bne	.L65
 557:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				SD_CS_HIGH();
 951              		.loc 1 557 0
 952 014e 0022     		movs	r2, #0
 953 0150 0092     		str	r2, [sp]
 954 0152 FF23     		movs	r3, #255
 955 0154 2921     		movs	r1, #41
 956 0156 02A8     		add	r0, sp, #8
 957 0158 FFF7FEFF 		bl	SD_SendCmd
 958              	.LVL87:
 959 015c 0298     		ldr	r0, [sp, #8]	@ unaligned
 960 015e 0690     		str	r0, [sp, #24]
 558:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				SD_IO_WriteByte(SD_DUMMY_BYTE);
 961              		.loc 1 558 0
 962 0160 0122     		movs	r2, #1
 963 0162 2021     		movs	r1, #32
 964 0164 1648     		ldr	r0, .L68
 965 0166 FFF7FEFF 		bl	HAL_GPIO_WritePin
 966              	.LVL88:
 559:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			} while (response.r1 == SD_R1_IN_IDLE_STATE);
 967              		.loc 1 559 0
 968 016a FF20     		movs	r0, #255
 969 016c FFF7FEFF 		bl	SD_IO_WriteByte
 970              	.LVL89:
 560:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		}
 971              		.loc 1 560 0
 972 0170 9DF81830 		ldrb	r3, [sp, #24]	@ zero_extendqisi2
 973 0174 012B     		cmp	r3, #1
 974 0176 D5D0     		beq	.L63
 975              	.L62:
 564:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_CS_HIGH();
 976              		.loc 1 564 0
 977 0178 0323     		movs	r3, #3
 978 017a 0093     		str	r3, [sp]
 979 017c FF23     		movs	r3, #255
 980 017e 0022     		movs	r2, #0
 981 0180 3A21     		movs	r1, #58
 982 0182 02A8     		add	r0, sp, #8
 983 0184 FFF7FEFF 		bl	SD_SendCmd
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 31


 984              	.LVL90:
 985 0188 0298     		ldr	r0, [sp, #8]	@ unaligned
 986 018a 0690     		str	r0, [sp, #24]
 565:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_IO_WriteByte(SD_DUMMY_BYTE);
 987              		.loc 1 565 0
 988 018c 0122     		movs	r2, #1
 989 018e 2021     		movs	r1, #32
 990 0190 0B48     		ldr	r0, .L68
 991 0192 FFF7FEFF 		bl	HAL_GPIO_WritePin
 992              	.LVL91:
 566:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		if (response.r1 != SD_R1_NO_ERROR) {
 993              		.loc 1 566 0
 994 0196 FF20     		movs	r0, #255
 995 0198 FFF7FEFF 		bl	SD_IO_WriteByte
 996              	.LVL92:
 567:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			return BSP_SD_ERROR;
 997              		.loc 1 567 0
 998 019c 9DF81840 		ldrb	r4, [sp, #24]	@ zero_extendqisi2
 999 01a0 64B9     		cbnz	r4, .L66
 570:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	} else {
 1000              		.loc 1 570 0
 1001 01a2 9DF81930 		ldrb	r3, [sp, #25]	@ zero_extendqisi2
 1002 01a6 C3F38013 		ubfx	r3, r3, #6, #1
 1003 01aa 064A     		ldr	r2, .L68+4
 1004 01ac 1380     		strh	r3, [r2]	@ movhi
 1005 01ae 00E0     		b	.L57
 1006              	.L64:
 507:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		}
 1007              		.loc 1 507 0
 1008 01b0 0124     		movs	r4, #1
 1009              	.L57:
 576:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1010              		.loc 1 576 0
 1011 01b2 2046     		mov	r0, r4
 1012 01b4 08B0     		add	sp, sp, #32
 1013              	.LCFI23:
 1014              		.cfi_remember_state
 1015              		.cfi_def_cfa_offset 16
 1016              		@ sp needed
 1017 01b6 70BD     		pop	{r4, r5, r6, pc}
 1018              	.L65:
 1019              	.LCFI24:
 1020              		.cfi_restore_state
 554:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				}
 1021              		.loc 1 554 0
 1022 01b8 3446     		mov	r4, r6
 1023 01ba FAE7     		b	.L57
 1024              	.L66:
 568:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		}
 1025              		.loc 1 568 0
 1026 01bc 3446     		mov	r4, r6
 1027 01be F8E7     		b	.L57
 1028              	.L69:
 1029              		.align	2
 1030              	.L68:
 1031 01c0 000C0140 		.word	1073810432
 1032 01c4 00000000 		.word	.LANCHOR1
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 32


 1033              		.cfi_endproc
 1034              	.LFE84:
 1036              		.section	.text.SD_WaitData,"ax",%progbits
 1037              		.align	1
 1038              		.syntax unified
 1039              		.thumb
 1040              		.thumb_func
 1041              		.fpu softvfp
 1043              	SD_WaitData:
 1044              	.LFB90:
 648:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 649:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static uint8_t SD_GetCSDRegister(SD_CSD *Csd)
 650:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 651:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint16_t counter = 0;
 652:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t CSD_Tab[16];
 653:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t retr = BSP_SD_ERROR;
 654:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CmdAnswer_typedef response;
 655:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 656:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Send CMD9 (CSD register) or CMD10(CSD register) and Wait for response in the R1 format (0x00 is
 657:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	response = SD_SendCmd(SD_CMD_SEND_CSD, 0, 0xFF, SD_ANSWER_R1_EXPECTED);
 658:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (response.r1 == SD_R1_NO_ERROR) {
 659:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		if (SD_WaitData(SD_TOKEN_START_DATA_SINGLE_BLOCK_READ) == BSP_SD_OK) {
 660:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			for (counter = 0; counter < 16; counter++) {
 661:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				// Store CSD register value on CSD_Tab
 662:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				CSD_Tab[counter] = SD_IO_WriteByte(SD_DUMMY_BYTE);
 663:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			}
 664:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 665:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Get CRC bytes (not really needed by us, but required by SD)
 666:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_IO_WriteByte(SD_DUMMY_BYTE);
 667:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_IO_WriteByte(SD_DUMMY_BYTE);
 668:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 669:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// CSD header decoding
 670:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 671:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 0
 672:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->CSDStruct = (CSD_Tab[0] & 0xC0) >> 6;
 673:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->Reserved1 =	CSD_Tab[0] & 0x3F;
 674:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 675:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 1
 676:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->TAAC = CSD_Tab[1];
 677:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 678:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 2
 679:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->NSAC = CSD_Tab[2];
 680:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 681:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 3
 682:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->MaxBusClkFrec = CSD_Tab[3];
 683:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 684:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 4/5
 685:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->CardComdClasses = (CSD_Tab[4] << 4) | ((CSD_Tab[5] & 0xF0) >> 4);
 686:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->RdBlockLen = CSD_Tab[5] & 0x0F;
 687:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 688:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 6
 689:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->PartBlockRead	 = (CSD_Tab[6] & 0x80) >> 7;
 690:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->WrBlockMisalign = (CSD_Tab[6] & 0x40) >> 6;
 691:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->RdBlockMisalign = (CSD_Tab[6] & 0x20) >> 5;
 692:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->DSRImpl				 = (CSD_Tab[6] & 0x10) >> 4;
 693:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 694:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// CSD v1/v2 decoding
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 33


 695:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 696:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			if (flag_SDHC == 0) {
 697:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				Csd->version.v1.Reserved1 = ((CSD_Tab[6] & 0x0C) >> 2);
 698:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 699:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				Csd->version.v1.DeviceSize =	((CSD_Tab[6] & 0x03) << 10)
 700:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 												|	(CSD_Tab[7] << 2)
 701:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 												| ((CSD_Tab[8] & 0xC0) >> 6);
 702:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				Csd->version.v1.MaxRdCurrentVDDMin = (CSD_Tab[8] & 0x38) >> 3;
 703:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				Csd->version.v1.MaxRdCurrentVDDMax = (CSD_Tab[8] & 0x07);
 704:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				Csd->version.v1.MaxWrCurrentVDDMin = (CSD_Tab[9] & 0xE0) >> 5;
 705:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				Csd->version.v1.MaxWrCurrentVDDMax = (CSD_Tab[9] & 0x1C) >> 2;
 706:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				Csd->version.v1.DeviceSizeMul = ((CSD_Tab[9] & 0x03) << 1)
 707:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 												| ((CSD_Tab[10] & 0x80) >> 7);
 708:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			} else {
 709:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				Csd->version.v2.Reserved1 = ((CSD_Tab[6] & 0x0F) << 2) | ((CSD_Tab[7] & 0xC0) >> 6);
 710:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				Csd->version.v2.DeviceSize = ((CSD_Tab[7] & 0x3F) << 16) | (CSD_Tab[8] << 8) | CSD_Tab[9];
 711:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				Csd->version.v2.Reserved2 = ((CSD_Tab[10] & 0x80) >> 8);
 712:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			}
 713:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 714:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->EraseSingleBlockEnable = (CSD_Tab[10] & 0x40) >> 6;
 715:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->EraseSectorSize	 = ((CSD_Tab[10] & 0x3F) << 1)
 716:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 									   | ((CSD_Tab[11] & 0x80) >> 7);
 717:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->WrProtectGrSize	 = (CSD_Tab[11] & 0x7F);
 718:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->WrProtectGrEnable = (CSD_Tab[12] & 0x80) >> 7;
 719:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->Reserved2				 = (CSD_Tab[12] & 0x60) >> 5;
 720:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->WrSpeedFact			 = (CSD_Tab[12] & 0x1C) >> 2;
 721:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->MaxWrBlockLen		 = ((CSD_Tab[12] & 0x03) << 2)
 722:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 									   | ((CSD_Tab[13] & 0xC0) >> 6);
 723:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->WriteBlockPartial = (CSD_Tab[13] & 0x20) >> 5;
 724:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->Reserved3				 = (CSD_Tab[13] & 0x1F);
 725:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->FileFormatGrouop	= (CSD_Tab[14] & 0x80) >> 7;
 726:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->CopyFlag					= (CSD_Tab[14] & 0x40) >> 6;
 727:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->PermWrProtect		 = (CSD_Tab[14] & 0x20) >> 5;
 728:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->TempWrProtect		 = (CSD_Tab[14] & 0x10) >> 4;
 729:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->FileFormat				= (CSD_Tab[14] & 0x0C) >> 2;
 730:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->Reserved4				 = (CSD_Tab[14] & 0x03);
 731:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->crc							 = (CSD_Tab[15] & 0xFE) >> 1;
 732:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->Reserved5				 = (CSD_Tab[15] & 0x01);
 733:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 734:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			retr = BSP_SD_OK;
 735:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		}
 736:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 737:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 738:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Send dummy byte: 8 Clock pulses of delay
 739:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CS_HIGH();
 740:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteByte(SD_DUMMY_BYTE);
 741:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 742:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Return the reponse
 743:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	return retr;
 744:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 745:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 746:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static uint8_t SD_GetCIDRegister(SD_CID *Cid)
 747:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 748:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint32_t counter = 0;
 749:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t retr = BSP_SD_ERROR;
 750:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t CID_Tab[16];
 751:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CmdAnswer_typedef response;
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 34


 752:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 753:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Send CMD10 (CID register) and Wait for response in the R1 format (0x00 is no errors)
 754:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	response = SD_SendCmd(SD_CMD_SEND_CID, 0, 0xFF, SD_ANSWER_R1_EXPECTED);
 755:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (response.r1 == SD_R1_NO_ERROR) {
 756:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		if (SD_WaitData(SD_TOKEN_START_DATA_SINGLE_BLOCK_READ) == BSP_SD_OK) {
 757:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Store CID register value on CID_Tab
 758:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			for (counter = 0; counter < 16; counter++) {
 759:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				CID_Tab[counter] = SD_IO_WriteByte(SD_DUMMY_BYTE);
 760:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			}
 761:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 762:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Get CRC bytes (not really needed by us, but required by SD)
 763:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_IO_WriteByte(SD_DUMMY_BYTE);
 764:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_IO_WriteByte(SD_DUMMY_BYTE);
 765:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 766:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 0
 767:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Cid->ManufacturerID = CID_Tab[0];
 768:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 769:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 1
 770:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Cid->OEM_AppliID = CID_Tab[1] << 8;
 771:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 772:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 2
 773:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Cid->OEM_AppliID |= CID_Tab[2];
 774:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 775:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 3
 776:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Cid->ProdName1 = CID_Tab[3] << 24;
 777:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 778:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 4
 779:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Cid->ProdName1 |= CID_Tab[4] << 16;
 780:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 781:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 5
 782:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Cid->ProdName1 |= CID_Tab[5] << 8;
 783:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 784:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 6
 785:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Cid->ProdName1 |= CID_Tab[6];
 786:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 787:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 7
 788:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Cid->ProdName2 = CID_Tab[7];
 789:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 790:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 8
 791:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Cid->ProdRev = CID_Tab[8];
 792:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 793:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 9
 794:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Cid->ProdSN = CID_Tab[9] << 24;
 795:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 796:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 10
 797:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Cid->ProdSN |= CID_Tab[10] << 16;
 798:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 799:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 11
 800:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Cid->ProdSN |= CID_Tab[11] << 8;
 801:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 802:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 12
 803:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Cid->ProdSN |= CID_Tab[12];
 804:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 805:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 13
 806:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Cid->Reserved1 |= (CID_Tab[13] & 0xF0) >> 4;
 807:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Cid->ManufactDate = (CID_Tab[13] & 0x0F) << 8;
 808:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 35


 809:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 14
 810:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Cid->ManufactDate |= CID_Tab[14];
 811:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 812:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Byte 15
 813:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Cid->CID_CRC = (CID_Tab[15] & 0xFE) >> 1;
 814:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Cid->Reserved2 = 1;
 815:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 816:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			retr = BSP_SD_OK;
 817:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		}
 818:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 819:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 820:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Send dummy byte: 8 Clock pulses of delay
 821:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CS_HIGH();
 822:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteByte(SD_DUMMY_BYTE);
 823:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 824:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Return the reponse
 825:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	return retr;
 826:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 827:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 828:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static uint8_t SD_GetDataResponse(void)
 829:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 830:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t dataresponse;
 831:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t rvalue = SD_DATA_OTHER_ERROR;
 832:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 833:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	dataresponse = SD_IO_WriteByte(SD_DUMMY_BYTE);
 834:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteByte(SD_DUMMY_BYTE); // read the busy response byte
 835:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 836:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Mask unused bits
 837:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	switch (dataresponse & 0x1F) {
 838:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	case SD_DATA_OK:
 839:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		rvalue = SD_DATA_OK;
 840:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 841:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Set CS High
 842:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_CS_HIGH();
 843:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Set CS Low
 844:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_CS_LOW();
 845:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 846:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Wait IO line return 0xFF
 847:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		while (SD_IO_WriteByte(SD_DUMMY_BYTE) != 0xFF);
 848:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		break;
 849:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	case SD_DATA_CRC_ERROR:
 850:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		rvalue =	SD_DATA_CRC_ERROR;
 851:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		break;
 852:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	case SD_DATA_WRITE_ERROR:
 853:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		rvalue = SD_DATA_WRITE_ERROR;
 854:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		break;
 855:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	default:
 856:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		break;
 857:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 858:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 859:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Return response
 860:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	return rvalue;
 861:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 862:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 863:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** static uint8_t SD_WaitData(uint8_t data)
 864:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** {
 1045              		.loc 1 864 0
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 36


 1046              		.cfi_startproc
 1047              		@ args = 0, pretend = 0, frame = 0
 1048              		@ frame_needed = 0, uses_anonymous_args = 0
 1049              	.LVL93:
 1050 0000 38B5     		push	{r3, r4, r5, lr}
 1051              	.LCFI25:
 1052              		.cfi_def_cfa_offset 16
 1053              		.cfi_offset 3, -16
 1054              		.cfi_offset 4, -12
 1055              		.cfi_offset 5, -8
 1056              		.cfi_offset 14, -4
 1057 0002 0546     		mov	r5, r0
 1058              	.LVL94:
 865:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint16_t timeout = 0xFFFF;
 1059              		.loc 1 865 0
 1060 0004 4FF6FF74 		movw	r4, #65535
 1061              	.LVL95:
 1062              	.L72:
 866:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t readvalue;
 867:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 868:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Check if response is got or a timeout is happen
 869:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 870:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	do {
 871:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		readvalue = SD_IO_WriteByte(SD_DUMMY_BYTE);
 1063              		.loc 1 871 0 discriminator 2
 1064 0008 FF20     		movs	r0, #255
 1065 000a FFF7FEFF 		bl	SD_IO_WriteByte
 1066              	.LVL96:
 872:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		timeout--;
 1067              		.loc 1 872 0 discriminator 2
 1068 000e 013C     		subs	r4, r4, #1
 1069              	.LVL97:
 1070 0010 A4B2     		uxth	r4, r4
 1071              	.LVL98:
 873:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	} while ((readvalue != data) && timeout);
 1072              		.loc 1 873 0 discriminator 2
 1073 0012 A842     		cmp	r0, r5
 1074 0014 01D0     		beq	.L71
 1075              		.loc 1 873 0 is_stmt 0 discriminator 1
 1076 0016 002C     		cmp	r4, #0
 1077 0018 F6D1     		bne	.L72
 1078              	.L71:
 874:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 875:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (timeout == 0) {
 1079              		.loc 1 875 0 is_stmt 1
 1080 001a 0CB1     		cbz	r4, .L76
 876:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// After time out
 877:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		return BSP_SD_TIMEOUT;
 878:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 879:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 880:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Right response got
 881:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	return BSP_SD_OK;
 1081              		.loc 1 881 0
 1082 001c 0020     		movs	r0, #0
 1083              	.LVL99:
 1084              	.L73:
 882:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 37


 1085              		.loc 1 882 0
 1086 001e 38BD     		pop	{r3, r4, r5, pc}
 1087              	.LVL100:
 1088              	.L76:
 877:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 1089              		.loc 1 877 0
 1090 0020 0220     		movs	r0, #2
 1091              	.LVL101:
 1092 0022 FCE7     		b	.L73
 1093              		.cfi_endproc
 1094              	.LFE90:
 1096              		.section	.text.SD_GetDataResponse,"ax",%progbits
 1097              		.align	1
 1098              		.syntax unified
 1099              		.thumb
 1100              		.thumb_func
 1101              		.fpu softvfp
 1103              	SD_GetDataResponse:
 1104              	.LFB89:
 829:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t dataresponse;
 1105              		.loc 1 829 0
 1106              		.cfi_startproc
 1107              		@ args = 0, pretend = 0, frame = 0
 1108              		@ frame_needed = 0, uses_anonymous_args = 0
 1109 0000 10B5     		push	{r4, lr}
 1110              	.LCFI26:
 1111              		.cfi_def_cfa_offset 8
 1112              		.cfi_offset 4, -8
 1113              		.cfi_offset 14, -4
 1114              	.LVL102:
 833:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteByte(SD_DUMMY_BYTE); // read the busy response byte
 1115              		.loc 1 833 0
 1116 0002 FF20     		movs	r0, #255
 1117 0004 FFF7FEFF 		bl	SD_IO_WriteByte
 1118              	.LVL103:
 1119 0008 0446     		mov	r4, r0
 1120              	.LVL104:
 834:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1121              		.loc 1 834 0
 1122 000a FF20     		movs	r0, #255
 1123 000c FFF7FEFF 		bl	SD_IO_WriteByte
 1124              	.LVL105:
 837:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	case SD_DATA_OK:
 1125              		.loc 1 837 0
 1126 0010 04F01F00 		and	r0, r4, #31
 1127 0014 0B28     		cmp	r0, #11
 1128 0016 19D0     		beq	.L83
 1129 0018 0D28     		cmp	r0, #13
 1130 001a 15D0     		beq	.L80
 1131 001c 0528     		cmp	r0, #5
 1132 001e 01D0     		beq	.L81
 831:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1133              		.loc 1 831 0
 1134 0020 FF20     		movs	r0, #255
 1135              	.LVL106:
 1136              	.L79:
 861:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 38


 1137              		.loc 1 861 0
 1138 0022 10BD     		pop	{r4, pc}
 1139              	.LVL107:
 1140              	.L81:
 842:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Set CS Low
 1141              		.loc 1 842 0
 1142 0024 0A4C     		ldr	r4, .L85
 1143              	.LVL108:
 1144 0026 0122     		movs	r2, #1
 1145 0028 2021     		movs	r1, #32
 1146 002a 2046     		mov	r0, r4
 1147 002c FFF7FEFF 		bl	HAL_GPIO_WritePin
 1148              	.LVL109:
 844:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1149              		.loc 1 844 0
 1150 0030 0022     		movs	r2, #0
 1151 0032 2021     		movs	r1, #32
 1152 0034 2046     		mov	r0, r4
 1153 0036 FFF7FEFF 		bl	HAL_GPIO_WritePin
 1154              	.LVL110:
 1155              	.L82:
 847:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		break;
 1156              		.loc 1 847 0 discriminator 1
 1157 003a FF20     		movs	r0, #255
 1158 003c FFF7FEFF 		bl	SD_IO_WriteByte
 1159              	.LVL111:
 1160 0040 FF28     		cmp	r0, #255
 1161 0042 FAD1     		bne	.L82
 839:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1162              		.loc 1 839 0
 1163 0044 0520     		movs	r0, #5
 1164 0046 ECE7     		b	.L79
 1165              	.LVL112:
 1166              	.L80:
 853:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		break;
 1167              		.loc 1 853 0
 1168 0048 0D20     		movs	r0, #13
 854:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	default:
 1169              		.loc 1 854 0
 1170 004a EAE7     		b	.L79
 1171              	.LVL113:
 1172              	.L83:
 850:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		break;
 1173              		.loc 1 850 0
 1174 004c 0B20     		movs	r0, #11
 1175 004e E8E7     		b	.L79
 1176              	.L86:
 1177              		.align	2
 1178              	.L85:
 1179 0050 000C0140 		.word	1073810432
 1180              		.cfi_endproc
 1181              	.LFE89:
 1183              		.section	.text.SD_GetCSDRegister,"ax",%progbits
 1184              		.align	1
 1185              		.syntax unified
 1186              		.thumb
 1187              		.thumb_func
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 39


 1188              		.fpu softvfp
 1190              	SD_GetCSDRegister:
 1191              	.LFB87:
 650:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint16_t counter = 0;
 1192              		.loc 1 650 0
 1193              		.cfi_startproc
 1194              		@ args = 0, pretend = 0, frame = 24
 1195              		@ frame_needed = 0, uses_anonymous_args = 0
 1196              	.LVL114:
 1197 0000 70B5     		push	{r4, r5, r6, lr}
 1198              	.LCFI27:
 1199              		.cfi_def_cfa_offset 16
 1200              		.cfi_offset 4, -16
 1201              		.cfi_offset 5, -12
 1202              		.cfi_offset 6, -8
 1203              		.cfi_offset 14, -4
 1204 0002 88B0     		sub	sp, sp, #32
 1205              	.LCFI28:
 1206              		.cfi_def_cfa_offset 48
 1207 0004 0546     		mov	r5, r0
 1208              	.LVL115:
 657:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (response.r1 == SD_R1_NO_ERROR) {
 1209              		.loc 1 657 0
 1210 0006 0022     		movs	r2, #0
 1211 0008 0092     		str	r2, [sp]
 1212 000a FF23     		movs	r3, #255
 1213 000c 0921     		movs	r1, #9
 1214 000e 02A8     		add	r0, sp, #8
 1215              	.LVL116:
 1216 0010 FFF7FEFF 		bl	SD_SendCmd
 1217              	.LVL117:
 658:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		if (SD_WaitData(SD_TOKEN_START_DATA_SINGLE_BLOCK_READ) == BSP_SD_OK) {
 1218              		.loc 1 658 0
 1219 0014 9DF80830 		ldrb	r3, [sp, #8]	@ zero_extendqisi2
 1220 0018 5BB1     		cbz	r3, .L96
 653:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CmdAnswer_typedef response;
 1221              		.loc 1 653 0
 1222 001a 0126     		movs	r6, #1
 1223              	.LVL118:
 1224              	.L88:
 739:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteByte(SD_DUMMY_BYTE);
 1225              		.loc 1 739 0
 1226 001c 0122     		movs	r2, #1
 1227 001e 2021     		movs	r1, #32
 1228 0020 8448     		ldr	r0, .L98
 1229 0022 FFF7FEFF 		bl	HAL_GPIO_WritePin
 1230              	.LVL119:
 740:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1231              		.loc 1 740 0
 1232 0026 FF20     		movs	r0, #255
 1233 0028 FFF7FEFF 		bl	SD_IO_WriteByte
 1234              	.LVL120:
 744:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1235              		.loc 1 744 0
 1236 002c 3046     		mov	r0, r6
 1237 002e 08B0     		add	sp, sp, #32
 1238              	.LCFI29:
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 40


 1239              		.cfi_remember_state
 1240              		.cfi_def_cfa_offset 16
 1241              		@ sp needed
 1242 0030 70BD     		pop	{r4, r5, r6, pc}
 1243              	.LVL121:
 1244              	.L96:
 1245              	.LCFI30:
 1246              		.cfi_restore_state
 659:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			for (counter = 0; counter < 16; counter++) {
 1247              		.loc 1 659 0
 1248 0032 FE20     		movs	r0, #254
 1249 0034 FFF7FEFF 		bl	SD_WaitData
 1250              	.LVL122:
 1251 0038 0646     		mov	r6, r0
 1252 003a 08B9     		cbnz	r0, .L97
 660:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				// Store CSD register value on CSD_Tab
 1253              		.loc 1 660 0
 1254 003c 0024     		movs	r4, #0
 1255 003e 0AE0     		b	.L89
 1256              	.L97:
 653:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CmdAnswer_typedef response;
 1257              		.loc 1 653 0
 1258 0040 0126     		movs	r6, #1
 1259 0042 EBE7     		b	.L88
 1260              	.LVL123:
 1261              	.L90:
 662:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			}
 1262              		.loc 1 662 0 discriminator 3
 1263 0044 FF20     		movs	r0, #255
 1264 0046 FFF7FEFF 		bl	SD_IO_WriteByte
 1265              	.LVL124:
 1266 004a 08AB     		add	r3, sp, #32
 1267 004c 2344     		add	r3, r3, r4
 1268 004e 03F8100C 		strb	r0, [r3, #-16]
 660:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				// Store CSD register value on CSD_Tab
 1269              		.loc 1 660 0 discriminator 3
 1270 0052 0134     		adds	r4, r4, #1
 1271              	.LVL125:
 1272 0054 A4B2     		uxth	r4, r4
 1273              	.LVL126:
 1274              	.L89:
 660:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				// Store CSD register value on CSD_Tab
 1275              		.loc 1 660 0 is_stmt 0 discriminator 1
 1276 0056 0F2C     		cmp	r4, #15
 1277 0058 F4D9     		bls	.L90
 666:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_IO_WriteByte(SD_DUMMY_BYTE);
 1278              		.loc 1 666 0 is_stmt 1
 1279 005a FF20     		movs	r0, #255
 1280 005c FFF7FEFF 		bl	SD_IO_WriteByte
 1281              	.LVL127:
 667:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1282              		.loc 1 667 0
 1283 0060 FF20     		movs	r0, #255
 1284 0062 FFF7FEFF 		bl	SD_IO_WriteByte
 1285              	.LVL128:
 672:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->Reserved1 =	CSD_Tab[0] & 0x3F;
 1286              		.loc 1 672 0
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 41


 1287 0066 9DF81020 		ldrb	r2, [sp, #16]	@ zero_extendqisi2
 1288 006a 9109     		lsrs	r1, r2, #6
 1289 006c 2B78     		ldrb	r3, [r5]	@ zero_extendqisi2
 1290 006e 61F30103 		bfi	r3, r1, #0, #2
 673:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1291              		.loc 1 673 0
 1292 0072 62F38703 		bfi	r3, r2, #2, #6
 1293 0076 2B70     		strb	r3, [r5]
 676:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1294              		.loc 1 676 0
 1295 0078 9DF81130 		ldrb	r3, [sp, #17]	@ zero_extendqisi2
 1296 007c 6B70     		strb	r3, [r5, #1]
 679:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1297              		.loc 1 679 0
 1298 007e 9DF81230 		ldrb	r3, [sp, #18]	@ zero_extendqisi2
 1299 0082 AB70     		strb	r3, [r5, #2]
 682:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1300              		.loc 1 682 0
 1301 0084 9DF81330 		ldrb	r3, [sp, #19]	@ zero_extendqisi2
 1302 0088 EB70     		strb	r3, [r5, #3]
 685:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->RdBlockLen = CSD_Tab[5] & 0x0F;
 1303              		.loc 1 685 0
 1304 008a 9DF81430 		ldrb	r3, [sp, #20]	@ zero_extendqisi2
 1305 008e 9DF81510 		ldrb	r1, [sp, #21]	@ zero_extendqisi2
 1306 0092 0A09     		lsrs	r2, r1, #4
 1307 0094 42EA0312 		orr	r2, r2, r3, lsl #4
 1308 0098 AB88     		ldrh	r3, [r5, #4]
 1309 009a 62F30B03 		bfi	r3, r2, #0, #12
 1310 009e AB80     		strh	r3, [r5, #4]	@ movhi
 686:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1311              		.loc 1 686 0
 1312 00a0 C3F30723 		ubfx	r3, r3, #8, #8
 1313 00a4 61F30713 		bfi	r3, r1, #4, #4
 1314 00a8 6B71     		strb	r3, [r5, #5]
 689:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->WrBlockMisalign = (CSD_Tab[6] & 0x40) >> 6;
 1315              		.loc 1 689 0
 1316 00aa 9DF81630 		ldrb	r3, [sp, #22]	@ zero_extendqisi2
 1317 00ae D909     		lsrs	r1, r3, #7
 1318 00b0 AA79     		ldrb	r2, [r5, #6]	@ zero_extendqisi2
 1319 00b2 61F30002 		bfi	r2, r1, #0, #1
 690:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->RdBlockMisalign = (CSD_Tab[6] & 0x20) >> 5;
 1320              		.loc 1 690 0
 1321 00b6 C3F38011 		ubfx	r1, r3, #6, #1
 1322 00ba 61F34102 		bfi	r2, r1, #1, #1
 691:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->DSRImpl				 = (CSD_Tab[6] & 0x10) >> 4;
 1323              		.loc 1 691 0
 1324 00be C3F34011 		ubfx	r1, r3, #5, #1
 1325 00c2 61F38202 		bfi	r2, r1, #2, #1
 692:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1326              		.loc 1 692 0
 1327 00c6 C3F30011 		ubfx	r1, r3, #4, #1
 1328 00ca 61F3C302 		bfi	r2, r1, #3, #1
 1329 00ce AA71     		strb	r2, [r5, #6]
 696:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				Csd->version.v1.Reserved1 = ((CSD_Tab[6] & 0x0C) >> 2);
 1330              		.loc 1 696 0
 1331 00d0 594A     		ldr	r2, .L98+4
 1332 00d2 1288     		ldrh	r2, [r2]
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 42


 1333 00d4 002A     		cmp	r2, #0
 1334 00d6 40F08E80 		bne	.L91
 697:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1335              		.loc 1 697 0
 1336 00da C3F38101 		ubfx	r1, r3, #2, #2
 1337 00de 2A7A     		ldrb	r2, [r5, #8]	@ zero_extendqisi2
 1338 00e0 61F30102 		bfi	r2, r1, #0, #2
 1339 00e4 2A72     		strb	r2, [r5, #8]
 699:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 												|	(CSD_Tab[7] << 2)
 1340              		.loc 1 699 0
 1341 00e6 9B02     		lsls	r3, r3, #10
 1342 00e8 03F44063 		and	r3, r3, #3072
 700:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 												| ((CSD_Tab[8] & 0xC0) >> 6);
 1343              		.loc 1 700 0
 1344 00ec 9DF81720 		ldrb	r2, [sp, #23]	@ zero_extendqisi2
 1345 00f0 43EA8203 		orr	r3, r3, r2, lsl #2
 701:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				Csd->version.v1.MaxRdCurrentVDDMin = (CSD_Tab[8] & 0x38) >> 3;
 1346              		.loc 1 701 0
 1347 00f4 9DF81820 		ldrb	r2, [sp, #24]	@ zero_extendqisi2
 1348 00f8 43EA9213 		orr	r3, r3, r2, lsr #6
 699:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 												|	(CSD_Tab[7] << 2)
 1349              		.loc 1 699 0
 1350 00fc 2989     		ldrh	r1, [r5, #8]
 1351 00fe 63F38D01 		bfi	r1, r3, #2, #12
 1352 0102 2981     		strh	r1, [r5, #8]	@ movhi
 702:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				Csd->version.v1.MaxRdCurrentVDDMax = (CSD_Tab[8] & 0x07);
 1353              		.loc 1 702 0
 1354 0104 C2F3C201 		ubfx	r1, r2, #3, #3
 1355 0108 AB7A     		ldrb	r3, [r5, #10]	@ zero_extendqisi2
 1356 010a 61F30203 		bfi	r3, r1, #0, #3
 703:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				Csd->version.v1.MaxWrCurrentVDDMin = (CSD_Tab[9] & 0xE0) >> 5;
 1357              		.loc 1 703 0
 1358 010e 62F3C503 		bfi	r3, r2, #3, #3
 1359 0112 AB72     		strb	r3, [r5, #10]
 704:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				Csd->version.v1.MaxWrCurrentVDDMax = (CSD_Tab[9] & 0x1C) >> 2;
 1360              		.loc 1 704 0
 1361 0114 9DF81930 		ldrb	r3, [sp, #25]	@ zero_extendqisi2
 1362 0118 5909     		lsrs	r1, r3, #5
 1363 011a EA7A     		ldrb	r2, [r5, #11]	@ zero_extendqisi2
 1364 011c 61F30202 		bfi	r2, r1, #0, #3
 705:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				Csd->version.v1.DeviceSizeMul = ((CSD_Tab[9] & 0x03) << 1)
 1365              		.loc 1 705 0
 1366 0120 C3F38201 		ubfx	r1, r3, #2, #3
 1367 0124 61F3C502 		bfi	r2, r1, #3, #3
 1368 0128 EA72     		strb	r2, [r5, #11]
 706:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 												| ((CSD_Tab[10] & 0x80) >> 7);
 1369              		.loc 1 706 0
 1370 012a 5B00     		lsls	r3, r3, #1
 1371 012c 03F00603 		and	r3, r3, #6
 707:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			} else {
 1372              		.loc 1 707 0
 1373 0130 9DF81A20 		ldrb	r2, [sp, #26]	@ zero_extendqisi2
 1374 0134 43EAD213 		orr	r3, r3, r2, lsr #7
 706:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 												| ((CSD_Tab[10] & 0x80) >> 7);
 1375              		.loc 1 706 0
 1376 0138 2A7B     		ldrb	r2, [r5, #12]	@ zero_extendqisi2
 1377 013a 63F30202 		bfi	r2, r3, #0, #3
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 43


 1378 013e 2A73     		strb	r2, [r5, #12]
 1379              	.L92:
 714:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->EraseSectorSize	 = ((CSD_Tab[10] & 0x3F) << 1)
 1380              		.loc 1 714 0
 1381 0140 9DF81A30 		ldrb	r3, [sp, #26]	@ zero_extendqisi2
 1382 0144 C3F38011 		ubfx	r1, r3, #6, #1
 1383 0148 2A7C     		ldrb	r2, [r5, #16]	@ zero_extendqisi2
 1384 014a 61F30002 		bfi	r2, r1, #0, #1
 715:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 									   | ((CSD_Tab[11] & 0x80) >> 7);
 1385              		.loc 1 715 0
 1386 014e 5B00     		lsls	r3, r3, #1
 1387 0150 03F07E03 		and	r3, r3, #126
 716:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->WrProtectGrSize	 = (CSD_Tab[11] & 0x7F);
 1388              		.loc 1 716 0
 1389 0154 9DF81B10 		ldrb	r1, [sp, #27]	@ zero_extendqisi2
 1390 0158 43EAD113 		orr	r3, r3, r1, lsr #7
 715:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 									   | ((CSD_Tab[11] & 0x80) >> 7);
 1391              		.loc 1 715 0
 1392 015c 63F34702 		bfi	r2, r3, #1, #7
 1393 0160 2A74     		strb	r2, [r5, #16]
 717:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->WrProtectGrEnable = (CSD_Tab[12] & 0x80) >> 7;
 1394              		.loc 1 717 0
 1395 0162 6A7C     		ldrb	r2, [r5, #17]	@ zero_extendqisi2
 1396 0164 61F30602 		bfi	r2, r1, #0, #7
 718:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->Reserved2				 = (CSD_Tab[12] & 0x60) >> 5;
 1397              		.loc 1 718 0
 1398 0168 9DF81C30 		ldrb	r3, [sp, #28]	@ zero_extendqisi2
 1399 016c D909     		lsrs	r1, r3, #7
 1400 016e 61F3C712 		bfi	r2, r1, #7, #1
 1401 0172 6A74     		strb	r2, [r5, #17]
 719:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->WrSpeedFact			 = (CSD_Tab[12] & 0x1C) >> 2;
 1402              		.loc 1 719 0
 1403 0174 C3F34111 		ubfx	r1, r3, #5, #2
 1404 0178 AA7C     		ldrb	r2, [r5, #18]	@ zero_extendqisi2
 1405 017a 61F30102 		bfi	r2, r1, #0, #2
 720:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->MaxWrBlockLen		 = ((CSD_Tab[12] & 0x03) << 2)
 1406              		.loc 1 720 0
 1407 017e C3F38201 		ubfx	r1, r3, #2, #3
 1408 0182 61F38402 		bfi	r2, r1, #2, #3
 1409 0186 AA74     		strb	r2, [r5, #18]
 721:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 									   | ((CSD_Tab[13] & 0xC0) >> 6);
 1410              		.loc 1 721 0
 1411 0188 9B00     		lsls	r3, r3, #2
 1412 018a 03F00C03 		and	r3, r3, #12
 722:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->WriteBlockPartial = (CSD_Tab[13] & 0x20) >> 5;
 1413              		.loc 1 722 0
 1414 018e 9DF81D10 		ldrb	r1, [sp, #29]	@ zero_extendqisi2
 1415 0192 43EA9113 		orr	r3, r3, r1, lsr #6
 721:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 									   | ((CSD_Tab[13] & 0xC0) >> 6);
 1416              		.loc 1 721 0
 1417 0196 EA7C     		ldrb	r2, [r5, #19]	@ zero_extendqisi2
 1418 0198 63F30302 		bfi	r2, r3, #0, #4
 723:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->Reserved3				 = (CSD_Tab[13] & 0x1F);
 1419              		.loc 1 723 0
 1420 019c C1F34010 		ubfx	r0, r1, #5, #1
 1421 01a0 1346     		mov	r3, r2
 1422 01a2 60F30413 		bfi	r3, r0, #4, #1
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 44


 1423 01a6 EB74     		strb	r3, [r5, #19]
 724:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->FileFormatGrouop	= (CSD_Tab[14] & 0x80) >> 7;
 1424              		.loc 1 724 0
 1425 01a8 2B7D     		ldrb	r3, [r5, #20]	@ zero_extendqisi2
 1426 01aa 61F30403 		bfi	r3, r1, #0, #5
 725:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->CopyFlag					= (CSD_Tab[14] & 0x40) >> 6;
 1427              		.loc 1 725 0
 1428 01ae 9DF81E20 		ldrb	r2, [sp, #30]	@ zero_extendqisi2
 1429 01b2 D109     		lsrs	r1, r2, #7
 1430 01b4 61F34513 		bfi	r3, r1, #5, #1
 726:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->PermWrProtect		 = (CSD_Tab[14] & 0x20) >> 5;
 1431              		.loc 1 726 0
 1432 01b8 C2F38011 		ubfx	r1, r2, #6, #1
 1433 01bc 61F38613 		bfi	r3, r1, #6, #1
 727:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->TempWrProtect		 = (CSD_Tab[14] & 0x10) >> 4;
 1434              		.loc 1 727 0
 1435 01c0 C2F34011 		ubfx	r1, r2, #5, #1
 1436 01c4 61F3C713 		bfi	r3, r1, #7, #1
 1437 01c8 2B75     		strb	r3, [r5, #20]
 728:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->FileFormat				= (CSD_Tab[14] & 0x0C) >> 2;
 1438              		.loc 1 728 0
 1439 01ca C2F30011 		ubfx	r1, r2, #4, #1
 1440 01ce 6B7D     		ldrb	r3, [r5, #21]	@ zero_extendqisi2
 1441 01d0 61F30003 		bfi	r3, r1, #0, #1
 729:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->Reserved4				 = (CSD_Tab[14] & 0x03);
 1442              		.loc 1 729 0
 1443 01d4 C2F38101 		ubfx	r1, r2, #2, #2
 1444 01d8 61F34203 		bfi	r3, r1, #1, #2
 730:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->crc							 = (CSD_Tab[15] & 0xFE) >> 1;
 1445              		.loc 1 730 0
 1446 01dc 62F3C403 		bfi	r3, r2, #3, #2
 1447 01e0 6B75     		strb	r3, [r5, #21]
 731:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Csd->Reserved5				 = (CSD_Tab[15] & 0x01);
 1448              		.loc 1 731 0
 1449 01e2 9DF81F20 		ldrb	r2, [sp, #31]	@ zero_extendqisi2
 1450 01e6 5108     		lsrs	r1, r2, #1
 1451 01e8 AB7D     		ldrb	r3, [r5, #22]	@ zero_extendqisi2
 1452 01ea 61F30603 		bfi	r3, r1, #0, #7
 732:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1453              		.loc 1 732 0
 1454 01ee 62F3C713 		bfi	r3, r2, #7, #1
 1455 01f2 AB75     		strb	r3, [r5, #22]
 1456              	.LVL129:
 1457 01f4 12E7     		b	.L88
 1458              	.LVL130:
 1459              	.L91:
 709:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				Csd->version.v2.DeviceSize = ((CSD_Tab[7] & 0x3F) << 16) | (CSD_Tab[8] << 8) | CSD_Tab[9];
 1460              		.loc 1 709 0
 1461 01f6 9B00     		lsls	r3, r3, #2
 1462 01f8 03F03C03 		and	r3, r3, #60
 1463 01fc 9DF81720 		ldrb	r2, [sp, #23]	@ zero_extendqisi2
 1464 0200 43EA9213 		orr	r3, r3, r2, lsr #6
 1465 0204 297A     		ldrb	r1, [r5, #8]	@ zero_extendqisi2
 1466 0206 63F30501 		bfi	r1, r3, #0, #6
 1467 020a 2972     		strb	r1, [r5, #8]
 710:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				Csd->version.v2.Reserved2 = ((CSD_Tab[10] & 0x80) >> 8);
 1468              		.loc 1 710 0
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 45


 1469 020c 1304     		lsls	r3, r2, #16
 1470 020e 03F47C13 		and	r3, r3, #4128768
 1471 0212 9DF81820 		ldrb	r2, [sp, #24]	@ zero_extendqisi2
 1472 0216 43EA0223 		orr	r3, r3, r2, lsl #8
 1473 021a 9DF81920 		ldrb	r2, [sp, #25]	@ zero_extendqisi2
 1474 021e 1343     		orrs	r3, r3, r2
 1475 0220 AA68     		ldr	r2, [r5, #8]
 1476 0222 63F39B12 		bfi	r2, r3, #6, #22
 1477 0226 AA60     		str	r2, [r5, #8]
 711:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			}
 1478              		.loc 1 711 0
 1479 0228 C2F30762 		ubfx	r2, r2, #24, #8
 1480 022c 6FF30412 		bfc	r2, #4, #1
 1481 0230 EA72     		strb	r2, [r5, #11]
 1482 0232 85E7     		b	.L92
 1483              	.L99:
 1484              		.align	2
 1485              	.L98:
 1486 0234 000C0140 		.word	1073810432
 1487 0238 00000000 		.word	.LANCHOR1
 1488              		.cfi_endproc
 1489              	.LFE87:
 1491              		.section	.text.SD_GetCIDRegister,"ax",%progbits
 1492              		.align	1
 1493              		.syntax unified
 1494              		.thumb
 1495              		.thumb_func
 1496              		.fpu softvfp
 1498              	SD_GetCIDRegister:
 1499              	.LFB88:
 747:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint32_t counter = 0;
 1500              		.loc 1 747 0
 1501              		.cfi_startproc
 1502              		@ args = 0, pretend = 0, frame = 24
 1503              		@ frame_needed = 0, uses_anonymous_args = 0
 1504              	.LVL131:
 1505 0000 70B5     		push	{r4, r5, r6, lr}
 1506              	.LCFI31:
 1507              		.cfi_def_cfa_offset 16
 1508              		.cfi_offset 4, -16
 1509              		.cfi_offset 5, -12
 1510              		.cfi_offset 6, -8
 1511              		.cfi_offset 14, -4
 1512 0002 88B0     		sub	sp, sp, #32
 1513              	.LCFI32:
 1514              		.cfi_def_cfa_offset 48
 1515 0004 0546     		mov	r5, r0
 1516              	.LVL132:
 754:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (response.r1 == SD_R1_NO_ERROR) {
 1517              		.loc 1 754 0
 1518 0006 0022     		movs	r2, #0
 1519 0008 0092     		str	r2, [sp]
 1520 000a FF23     		movs	r3, #255
 1521 000c 0A21     		movs	r1, #10
 1522 000e 02A8     		add	r0, sp, #8
 1523              	.LVL133:
 1524 0010 FFF7FEFF 		bl	SD_SendCmd
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 46


 1525              	.LVL134:
 755:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		if (SD_WaitData(SD_TOKEN_START_DATA_SINGLE_BLOCK_READ) == BSP_SD_OK) {
 1526              		.loc 1 755 0
 1527 0014 9DF80830 		ldrb	r3, [sp, #8]	@ zero_extendqisi2
 1528 0018 5BB1     		cbz	r3, .L107
 749:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t CID_Tab[16];
 1529              		.loc 1 749 0
 1530 001a 0126     		movs	r6, #1
 1531              	.LVL135:
 1532              	.L101:
 821:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteByte(SD_DUMMY_BYTE);
 1533              		.loc 1 821 0
 1534 001c 0122     		movs	r2, #1
 1535 001e 2021     		movs	r1, #32
 1536 0020 3948     		ldr	r0, .L109
 1537 0022 FFF7FEFF 		bl	HAL_GPIO_WritePin
 1538              	.LVL136:
 822:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1539              		.loc 1 822 0
 1540 0026 FF20     		movs	r0, #255
 1541 0028 FFF7FEFF 		bl	SD_IO_WriteByte
 1542              	.LVL137:
 826:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1543              		.loc 1 826 0
 1544 002c 3046     		mov	r0, r6
 1545 002e 08B0     		add	sp, sp, #32
 1546              	.LCFI33:
 1547              		.cfi_remember_state
 1548              		.cfi_def_cfa_offset 16
 1549              		@ sp needed
 1550 0030 70BD     		pop	{r4, r5, r6, pc}
 1551              	.LVL138:
 1552              	.L107:
 1553              	.LCFI34:
 1554              		.cfi_restore_state
 756:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Store CID register value on CID_Tab
 1555              		.loc 1 756 0
 1556 0032 FE20     		movs	r0, #254
 1557 0034 FFF7FEFF 		bl	SD_WaitData
 1558              	.LVL139:
 1559 0038 0646     		mov	r6, r0
 1560 003a 08B9     		cbnz	r0, .L108
 758:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				CID_Tab[counter] = SD_IO_WriteByte(SD_DUMMY_BYTE);
 1561              		.loc 1 758 0
 1562 003c 0024     		movs	r4, #0
 1563 003e 09E0     		b	.L102
 1564              	.L108:
 749:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t CID_Tab[16];
 1565              		.loc 1 749 0
 1566 0040 0126     		movs	r6, #1
 1567 0042 EBE7     		b	.L101
 1568              	.LVL140:
 1569              	.L103:
 759:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			}
 1570              		.loc 1 759 0 discriminator 3
 1571 0044 FF20     		movs	r0, #255
 1572 0046 FFF7FEFF 		bl	SD_IO_WriteByte
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 47


 1573              	.LVL141:
 1574 004a 08AB     		add	r3, sp, #32
 1575 004c 2344     		add	r3, r3, r4
 1576 004e 03F8100C 		strb	r0, [r3, #-16]
 758:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				CID_Tab[counter] = SD_IO_WriteByte(SD_DUMMY_BYTE);
 1577              		.loc 1 758 0 discriminator 3
 1578 0052 0134     		adds	r4, r4, #1
 1579              	.LVL142:
 1580              	.L102:
 758:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				CID_Tab[counter] = SD_IO_WriteByte(SD_DUMMY_BYTE);
 1581              		.loc 1 758 0 is_stmt 0 discriminator 1
 1582 0054 0F2C     		cmp	r4, #15
 1583 0056 F5D9     		bls	.L103
 763:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_IO_WriteByte(SD_DUMMY_BYTE);
 1584              		.loc 1 763 0 is_stmt 1
 1585 0058 FF20     		movs	r0, #255
 1586 005a FFF7FEFF 		bl	SD_IO_WriteByte
 1587              	.LVL143:
 764:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1588              		.loc 1 764 0
 1589 005e FF20     		movs	r0, #255
 1590 0060 FFF7FEFF 		bl	SD_IO_WriteByte
 1591              	.LVL144:
 767:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1592              		.loc 1 767 0
 1593 0064 9DF81030 		ldrb	r3, [sp, #16]	@ zero_extendqisi2
 1594 0068 2B70     		strb	r3, [r5]
 770:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1595              		.loc 1 770 0
 1596 006a 9DF81130 		ldrb	r3, [sp, #17]	@ zero_extendqisi2
 1597 006e 1B02     		lsls	r3, r3, #8
 1598 0070 6B80     		strh	r3, [r5, #2]	@ movhi
 773:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1599              		.loc 1 773 0
 1600 0072 6A88     		ldrh	r2, [r5, #2]
 1601 0074 9DF81230 		ldrb	r3, [sp, #18]	@ zero_extendqisi2
 1602 0078 1343     		orrs	r3, r3, r2
 1603 007a 6B80     		strh	r3, [r5, #2]	@ movhi
 776:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1604              		.loc 1 776 0
 1605 007c 9DF81330 		ldrb	r3, [sp, #19]	@ zero_extendqisi2
 1606 0080 1B06     		lsls	r3, r3, #24
 1607 0082 6B60     		str	r3, [r5, #4]
 779:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1608              		.loc 1 779 0
 1609 0084 6B68     		ldr	r3, [r5, #4]
 1610 0086 9DF81420 		ldrb	r2, [sp, #20]	@ zero_extendqisi2
 1611 008a 43EA0243 		orr	r3, r3, r2, lsl #16
 1612 008e 6B60     		str	r3, [r5, #4]
 782:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1613              		.loc 1 782 0
 1614 0090 6B68     		ldr	r3, [r5, #4]
 1615 0092 9DF81520 		ldrb	r2, [sp, #21]	@ zero_extendqisi2
 1616 0096 43EA0223 		orr	r3, r3, r2, lsl #8
 1617 009a 6B60     		str	r3, [r5, #4]
 785:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1618              		.loc 1 785 0
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 48


 1619 009c 6B68     		ldr	r3, [r5, #4]
 1620 009e 9DF81620 		ldrb	r2, [sp, #22]	@ zero_extendqisi2
 1621 00a2 1343     		orrs	r3, r3, r2
 1622 00a4 6B60     		str	r3, [r5, #4]
 788:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1623              		.loc 1 788 0
 1624 00a6 9DF81730 		ldrb	r3, [sp, #23]	@ zero_extendqisi2
 1625 00aa 2B72     		strb	r3, [r5, #8]
 791:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1626              		.loc 1 791 0
 1627 00ac 9DF81830 		ldrb	r3, [sp, #24]	@ zero_extendqisi2
 1628 00b0 6B72     		strb	r3, [r5, #9]
 794:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1629              		.loc 1 794 0
 1630 00b2 9DF81930 		ldrb	r3, [sp, #25]	@ zero_extendqisi2
 1631 00b6 1B06     		lsls	r3, r3, #24
 1632 00b8 EB60     		str	r3, [r5, #12]
 797:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1633              		.loc 1 797 0
 1634 00ba EB68     		ldr	r3, [r5, #12]
 1635 00bc 9DF81A20 		ldrb	r2, [sp, #26]	@ zero_extendqisi2
 1636 00c0 43EA0243 		orr	r3, r3, r2, lsl #16
 1637 00c4 EB60     		str	r3, [r5, #12]
 800:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1638              		.loc 1 800 0
 1639 00c6 EB68     		ldr	r3, [r5, #12]
 1640 00c8 9DF81B20 		ldrb	r2, [sp, #27]	@ zero_extendqisi2
 1641 00cc 43EA0223 		orr	r3, r3, r2, lsl #8
 1642 00d0 EB60     		str	r3, [r5, #12]
 803:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1643              		.loc 1 803 0
 1644 00d2 EB68     		ldr	r3, [r5, #12]
 1645 00d4 9DF81C20 		ldrb	r2, [sp, #28]	@ zero_extendqisi2
 1646 00d8 1343     		orrs	r3, r3, r2
 1647 00da EB60     		str	r3, [r5, #12]
 806:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Cid->ManufactDate = (CID_Tab[13] & 0x0F) << 8;
 1648              		.loc 1 806 0
 1649 00dc 2A7C     		ldrb	r2, [r5, #16]	@ zero_extendqisi2
 1650 00de 9DF81D30 		ldrb	r3, [sp, #29]	@ zero_extendqisi2
 1651 00e2 42EA1312 		orr	r2, r2, r3, lsr #4
 1652 00e6 2A74     		strb	r2, [r5, #16]
 807:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1653              		.loc 1 807 0
 1654 00e8 1B02     		lsls	r3, r3, #8
 1655 00ea 03F47063 		and	r3, r3, #3840
 1656 00ee 6B82     		strh	r3, [r5, #18]	@ movhi
 810:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1657              		.loc 1 810 0
 1658 00f0 6A8A     		ldrh	r2, [r5, #18]
 1659 00f2 9DF81E30 		ldrb	r3, [sp, #30]	@ zero_extendqisi2
 1660 00f6 1343     		orrs	r3, r3, r2
 1661 00f8 6B82     		strh	r3, [r5, #18]	@ movhi
 813:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			Cid->Reserved2 = 1;
 1662              		.loc 1 813 0
 1663 00fa 9DF81F30 		ldrb	r3, [sp, #31]	@ zero_extendqisi2
 1664 00fe 5B08     		lsrs	r3, r3, #1
 1665 0100 2B75     		strb	r3, [r5, #20]
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 49


 814:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1666              		.loc 1 814 0
 1667 0102 0123     		movs	r3, #1
 1668 0104 6B75     		strb	r3, [r5, #21]
 1669              	.LVL145:
 1670 0106 89E7     		b	.L101
 1671              	.L110:
 1672              		.align	2
 1673              	.L109:
 1674 0108 000C0140 		.word	1073810432
 1675              		.cfi_endproc
 1676              	.LFE88:
 1678              		.section	.text.SD_IO_ReadData,"ax",%progbits
 1679              		.align	1
 1680              		.global	SD_IO_ReadData
 1681              		.syntax unified
 1682              		.thumb
 1683              		.thumb_func
 1684              		.fpu softvfp
 1686              	SD_IO_ReadData:
 1687              	.LFB76:
 270:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/* Send the byte */
 1688              		.loc 1 270 0
 1689              		.cfi_startproc
 1690              		@ args = 0, pretend = 0, frame = 0
 1691              		@ frame_needed = 0, uses_anonymous_args = 0
 1692              	.LVL146:
 1693 0000 08B5     		push	{r3, lr}
 1694              	.LCFI35:
 1695              		.cfi_def_cfa_offset 8
 1696              		.cfi_offset 3, -8
 1697              		.cfi_offset 14, -4
 272:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 1698              		.loc 1 272 0
 1699 0002 0A46     		mov	r2, r1
 1700 0004 0146     		mov	r1, r0
 1701              	.LVL147:
 1702 0006 FFF7FEFF 		bl	SD_IO_WriteReadData
 1703              	.LVL148:
 273:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1704              		.loc 1 273 0
 1705 000a 08BD     		pop	{r3, pc}
 1706              		.cfi_endproc
 1707              	.LFE76:
 1709              		.section	.text.SD_IO_WriteData,"ax",%progbits
 1710              		.align	1
 1711              		.global	SD_IO_WriteData
 1712              		.syntax unified
 1713              		.thumb
 1714              		.thumb_func
 1715              		.fpu softvfp
 1717              	SD_IO_WriteData:
 1718              	.LFB77:
 276:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	/* Send the byte */
 1719              		.loc 1 276 0
 1720              		.cfi_startproc
 1721              		@ args = 0, pretend = 0, frame = 0
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 50


 1722              		@ frame_needed = 0, uses_anonymous_args = 0
 1723              	.LVL149:
 1724 0000 08B5     		push	{r3, lr}
 1725              	.LCFI36:
 1726              		.cfi_def_cfa_offset 8
 1727              		.cfi_offset 3, -8
 1728              		.cfi_offset 14, -4
 278:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SPIx_FlushFifo();
 1729              		.loc 1 278 0
 1730 0002 FFF7FEFF 		bl	SPIx_WriteData
 1731              	.LVL150:
 279:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 1732              		.loc 1 279 0
 1733 0006 FFF7FEFF 		bl	SPIx_FlushFifo
 1734              	.LVL151:
 280:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1735              		.loc 1 280 0
 1736 000a 08BD     		pop	{r3, pc}
 1737              		.cfi_endproc
 1738              	.LFE77:
 1740              		.section	.text.BSP_SD_Init,"ax",%progbits
 1741              		.align	1
 1742              		.global	BSP_SD_Init
 1743              		.syntax unified
 1744              		.thumb
 1745              		.thumb_func
 1746              		.fpu softvfp
 1748              	BSP_SD_Init:
 1749              	.LFB78:
 283:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	// Configure IO functionalities for SD pin
 1750              		.loc 1 283 0
 1751              		.cfi_startproc
 1752              		@ args = 0, pretend = 0, frame = 0
 1753              		@ frame_needed = 0, uses_anonymous_args = 0
 1754 0000 08B5     		push	{r3, lr}
 1755              	.LCFI37:
 1756              		.cfi_def_cfa_offset 8
 1757              		.cfi_offset 3, -8
 1758              		.cfi_offset 14, -4
 285:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1759              		.loc 1 285 0
 1760 0002 FFF7FEFF 		bl	SD_IO_Init
 1761              	.LVL152:
 288:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1762              		.loc 1 288 0
 1763 0006 034B     		ldr	r3, .L117
 1764 0008 0122     		movs	r2, #1
 1765 000a 1A70     		strb	r2, [r3]
 291:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 1766              		.loc 1 291 0
 1767 000c FFF7FEFF 		bl	SD_GoIdleState
 1768              	.LVL153:
 292:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1769              		.loc 1 292 0
 1770 0010 08BD     		pop	{r3, pc}
 1771              	.L118:
 1772 0012 00BF     		.align	2
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 51


 1773              	.L117:
 1774 0014 00000000 		.word	.LANCHOR2
 1775              		.cfi_endproc
 1776              	.LFE78:
 1778              		.section	.text.BSP_SD_ReadBlocks,"ax",%progbits
 1779              		.align	1
 1780              		.global	BSP_SD_ReadBlocks
 1781              		.syntax unified
 1782              		.thumb
 1783              		.thumb_func
 1784              		.fpu softvfp
 1786              	BSP_SD_ReadBlocks:
 1787              	.LFB79:
 295:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint32_t offset = 0;
 1788              		.loc 1 295 0
 1789              		.cfi_startproc
 1790              		@ args = 0, pretend = 0, frame = 24
 1791              		@ frame_needed = 0, uses_anonymous_args = 0
 1792              	.LVL154:
 1793 0000 2DE9F04F 		push	{r4, r5, r6, r7, r8, r9, r10, fp, lr}
 1794              	.LCFI38:
 1795              		.cfi_def_cfa_offset 36
 1796              		.cfi_offset 4, -36
 1797              		.cfi_offset 5, -32
 1798              		.cfi_offset 6, -28
 1799              		.cfi_offset 7, -24
 1800              		.cfi_offset 8, -20
 1801              		.cfi_offset 9, -16
 1802              		.cfi_offset 10, -12
 1803              		.cfi_offset 11, -8
 1804              		.cfi_offset 14, -4
 1805 0004 89B0     		sub	sp, sp, #36
 1806              	.LCFI39:
 1807              		.cfi_def_cfa_offset 72
 1808 0006 8346     		mov	fp, r0
 1809 0008 8A46     		mov	r10, r1
 1810 000a 9046     		mov	r8, r2
 1811 000c 0392     		str	r2, [sp, #12]
 1812 000e 1C46     		mov	r4, r3
 1813              	.LVL155:
 303:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CS_HIGH();
 1814              		.loc 1 303 0
 1815 0010 0023     		movs	r3, #0
 1816              	.LVL156:
 1817 0012 0093     		str	r3, [sp]
 1818 0014 FF23     		movs	r3, #255
 1819 0016 1021     		movs	r1, #16
 1820              	.LVL157:
 1821 0018 06A8     		add	r0, sp, #24
 1822              	.LVL158:
 1823 001a FFF7FEFF 		bl	SD_SendCmd
 1824              	.LVL159:
 304:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteByte(SD_DUMMY_BYTE);
 1825              		.loc 1 304 0
 1826 001e 0122     		movs	r2, #1
 1827 0020 2021     		movs	r1, #32
 1828 0022 3048     		ldr	r0, .L132
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 52


 1829 0024 FFF7FEFF 		bl	HAL_GPIO_WritePin
 1830              	.LVL160:
 305:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (response.r1 != SD_R1_NO_ERROR) {
 1831              		.loc 1 305 0
 1832 0028 FF20     		movs	r0, #255
 1833 002a FFF7FEFF 		bl	SD_IO_WriteByte
 1834              	.LVL161:
 306:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		goto error;
 1835              		.loc 1 306 0
 1836 002e 9DF81860 		ldrb	r6, [sp, #24]	@ zero_extendqisi2
 1837 0032 8EB1     		cbz	r6, .L131
 298:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CmdAnswer_typedef response;
 1838              		.loc 1 298 0
 1839 0034 0027     		movs	r7, #0
 297:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t *ptr = NULL;
 1840              		.loc 1 297 0
 1841 0036 0126     		movs	r6, #1
 1842              	.LVL162:
 1843              	.L120:
 349:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteByte(SD_DUMMY_BYTE);
 1844              		.loc 1 349 0
 1845 0038 0122     		movs	r2, #1
 1846 003a 2021     		movs	r1, #32
 1847 003c 2948     		ldr	r0, .L132
 1848 003e FFF7FEFF 		bl	HAL_GPIO_WritePin
 1849              	.LVL163:
 350:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (ptr != NULL) {
 1850              		.loc 1 350 0
 1851 0042 FF20     		movs	r0, #255
 1852 0044 FFF7FEFF 		bl	SD_IO_WriteByte
 1853              	.LVL164:
 351:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		free(ptr);
 1854              		.loc 1 351 0
 1855 0048 17B1     		cbz	r7, .L124
 352:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 1856              		.loc 1 352 0
 1857 004a 3846     		mov	r0, r7
 1858 004c FFF7FEFF 		bl	free
 1859              	.LVL165:
 1860              	.L124:
 357:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1861              		.loc 1 357 0
 1862 0050 3046     		mov	r0, r6
 1863 0052 09B0     		add	sp, sp, #36
 1864              	.LCFI40:
 1865              		.cfi_remember_state
 1866              		.cfi_def_cfa_offset 36
 1867              		@ sp needed
 1868 0054 BDE8F08F 		pop	{r4, r5, r6, r7, r8, r9, r10, fp, pc}
 1869              	.LVL166:
 1870              	.L131:
 1871              	.LCFI41:
 1872              		.cfi_restore_state
 310:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (ptr == NULL) {
 1873              		.loc 1 310 0
 1874 0058 039D     		ldr	r5, [sp, #12]
 1875 005a 2846     		mov	r0, r5
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 53


 1876 005c FFF7FEFF 		bl	malloc
 1877              	.LVL167:
 311:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		goto error;
 1878              		.loc 1 311 0
 1879 0060 0746     		mov	r7, r0
 1880 0062 0028     		cmp	r0, #0
 1881 0064 38D0     		beq	.L126
 314:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1882              		.loc 1 314 0
 1883 0066 2A46     		mov	r2, r5
 1884 0068 FF21     		movs	r1, #255
 1885 006a FFF7FEFF 		bl	memset
 1886              	.LVL168:
 296:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t retr = BSP_SD_ERROR;
 1887              		.loc 1 296 0
 1888 006e 0025     		movs	r5, #0
 317:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Send CMD17 (SD_CMD_READ_SINGLE_BLOCK) to read one block
 1889              		.loc 1 317 0
 1890 0070 26E0     		b	.L121
 1891              	.LVL169:
 1892              	.L127:
 320:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 							  SD_ANSWER_R1_EXPECTED);
 1893              		.loc 1 320 0
 1894 0072 4246     		mov	r2, r8
 1895              	.L122:
 320:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 							  SD_ANSWER_R1_EXPECTED);
 1896              		.loc 1 320 0 is_stmt 0 discriminator 4
 1897 0074 0023     		movs	r3, #0
 1898 0076 0093     		str	r3, [sp]
 1899 0078 FF23     		movs	r3, #255
 1900 007a B1FBF2F2 		udiv	r2, r1, r2
 1901 007e 1121     		movs	r1, #17
 1902 0080 04A8     		add	r0, sp, #16
 1903 0082 FFF7FEFF 		bl	SD_SendCmd
 1904              	.LVL170:
 1905 0086 0498     		ldr	r0, [sp, #16]	@ unaligned
 322:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			goto error;
 1906              		.loc 1 322 0 is_stmt 1 discriminator 4
 1907 0088 C0B2     		uxtb	r0, r0
 1908 008a 38BB     		cbnz	r0, .L128
 327:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Read the SD block data : read NumByteToRead data
 1909              		.loc 1 327 0
 1910 008c FE20     		movs	r0, #254
 1911 008e FFF7FEFF 		bl	SD_WaitData
 1912              	.LVL171:
 1913 0092 28BB     		cbnz	r0, .L129
 329:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 1914              		.loc 1 329 0
 1915 0094 039A     		ldr	r2, [sp, #12]
 1916 0096 0BEB0501 		add	r1, fp, r5
 1917 009a 3846     		mov	r0, r7
 1918 009c FFF7FEFF 		bl	SD_IO_WriteReadData
 1919              	.LVL172:
 332:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// get CRC bytes (not really needed by us, but required by SD)
 1920              		.loc 1 332 0
 1921 00a0 4544     		add	r5, r5, r8
 1922              	.LVL173:
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 54


 334:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_IO_WriteByte(SD_DUMMY_BYTE);
 1923              		.loc 1 334 0
 1924 00a2 FF20     		movs	r0, #255
 1925 00a4 FFF7FEFF 		bl	SD_IO_WriteByte
 1926              	.LVL174:
 335:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		} else {
 1927              		.loc 1 335 0
 1928 00a8 FF20     		movs	r0, #255
 1929 00aa FFF7FEFF 		bl	SD_IO_WriteByte
 1930              	.LVL175:
 341:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_IO_WriteByte(SD_DUMMY_BYTE);
 1931              		.loc 1 341 0
 1932 00ae 0122     		movs	r2, #1
 1933 00b0 2021     		movs	r1, #32
 1934 00b2 0C48     		ldr	r0, .L132
 1935 00b4 FFF7FEFF 		bl	HAL_GPIO_WritePin
 1936              	.LVL176:
 342:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 1937              		.loc 1 342 0
 1938 00b8 FF20     		movs	r0, #255
 1939 00ba FFF7FEFF 		bl	SD_IO_WriteByte
 1940              	.LVL177:
 317:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Send CMD17 (SD_CMD_READ_SINGLE_BLOCK) to read one block
 1941              		.loc 1 317 0
 1942 00be 4C46     		mov	r4, r9
 1943              	.LVL178:
 1944              	.L121:
 1945 00c0 04F1FF39 		add	r9, r4, #-1
 1946              	.LVL179:
 1947 00c4 002C     		cmp	r4, #0
 1948 00c6 B7D0     		beq	.L120
 320:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 							  SD_ANSWER_R1_EXPECTED);
 1949              		.loc 1 320 0
 1950 00c8 05EB0A01 		add	r1, r5, r10
 1951 00cc 064B     		ldr	r3, .L132+4
 1952 00ce 1B88     		ldrh	r3, [r3]
 1953 00d0 012B     		cmp	r3, #1
 1954 00d2 CED0     		beq	.L127
 1955 00d4 0122     		movs	r2, #1
 1956 00d6 CDE7     		b	.L122
 1957              	.LVL180:
 1958              	.L126:
 297:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t *ptr = NULL;
 1959              		.loc 1 297 0
 1960 00d8 0126     		movs	r6, #1
 1961 00da ADE7     		b	.L120
 1962              	.LVL181:
 1963              	.L128:
 1964 00dc 0126     		movs	r6, #1
 1965 00de ABE7     		b	.L120
 1966              	.L129:
 1967 00e0 0126     		movs	r6, #1
 1968 00e2 A9E7     		b	.L120
 1969              	.L133:
 1970              		.align	2
 1971              	.L132:
 1972 00e4 000C0140 		.word	1073810432
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 55


 1973 00e8 00000000 		.word	.LANCHOR1
 1974              		.cfi_endproc
 1975              	.LFE79:
 1977              		.section	.text.BSP_SD_WriteBlocks,"ax",%progbits
 1978              		.align	1
 1979              		.global	BSP_SD_WriteBlocks
 1980              		.syntax unified
 1981              		.thumb
 1982              		.thumb_func
 1983              		.fpu softvfp
 1985              	BSP_SD_WriteBlocks:
 1986              	.LFB80:
 360:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint32_t offset = 0;
 1987              		.loc 1 360 0
 1988              		.cfi_startproc
 1989              		@ args = 0, pretend = 0, frame = 24
 1990              		@ frame_needed = 0, uses_anonymous_args = 0
 1991              	.LVL182:
 1992 0000 2DE9F04F 		push	{r4, r5, r6, r7, r8, r9, r10, fp, lr}
 1993              	.LCFI42:
 1994              		.cfi_def_cfa_offset 36
 1995              		.cfi_offset 4, -36
 1996              		.cfi_offset 5, -32
 1997              		.cfi_offset 6, -28
 1998              		.cfi_offset 7, -24
 1999              		.cfi_offset 8, -20
 2000              		.cfi_offset 9, -16
 2001              		.cfi_offset 10, -12
 2002              		.cfi_offset 11, -8
 2003              		.cfi_offset 14, -4
 2004 0004 89B0     		sub	sp, sp, #36
 2005              	.LCFI43:
 2006              		.cfi_def_cfa_offset 72
 2007 0006 8246     		mov	r10, r0
 2008 0008 8946     		mov	r9, r1
 2009 000a 9046     		mov	r8, r2
 2010 000c 0392     		str	r2, [sp, #12]
 2011 000e 1D46     		mov	r5, r3
 2012              	.LVL183:
 368:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CS_HIGH();
 2013              		.loc 1 368 0
 2014 0010 0023     		movs	r3, #0
 2015              	.LVL184:
 2016 0012 0093     		str	r3, [sp]
 2017 0014 FF23     		movs	r3, #255
 2018 0016 1021     		movs	r1, #16
 2019              	.LVL185:
 2020 0018 06A8     		add	r0, sp, #24
 2021              	.LVL186:
 2022 001a FFF7FEFF 		bl	SD_SendCmd
 2023              	.LVL187:
 369:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteByte(SD_DUMMY_BYTE);
 2024              		.loc 1 369 0
 2025 001e 0122     		movs	r2, #1
 2026 0020 2021     		movs	r1, #32
 2027 0022 3248     		ldr	r0, .L147
 2028 0024 FFF7FEFF 		bl	HAL_GPIO_WritePin
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 56


 2029              	.LVL188:
 370:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (response.r1 != SD_R1_NO_ERROR) {
 2030              		.loc 1 370 0
 2031 0028 FF20     		movs	r0, #255
 2032 002a FFF7FEFF 		bl	SD_IO_WriteByte
 2033              	.LVL189:
 371:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		goto error;
 2034              		.loc 1 371 0
 2035 002e 9DF81860 		ldrb	r6, [sp, #24]	@ zero_extendqisi2
 2036 0032 66B1     		cbz	r6, .L146
 362:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t *ptr = NULL;
 2037              		.loc 1 362 0
 2038 0034 0126     		movs	r6, #1
 2039              	.LVL190:
 2040              	.L135:
 423:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteByte(SD_DUMMY_BYTE);
 2041              		.loc 1 423 0
 2042 0036 0122     		movs	r2, #1
 2043 0038 2021     		movs	r1, #32
 2044 003a 2C48     		ldr	r0, .L147
 2045 003c FFF7FEFF 		bl	HAL_GPIO_WritePin
 2046              	.LVL191:
 424:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 2047              		.loc 1 424 0
 2048 0040 FF20     		movs	r0, #255
 2049 0042 FFF7FEFF 		bl	SD_IO_WriteByte
 2050              	.LVL192:
 428:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 2051              		.loc 1 428 0
 2052 0046 3046     		mov	r0, r6
 2053 0048 09B0     		add	sp, sp, #36
 2054              	.LCFI44:
 2055              		.cfi_remember_state
 2056              		.cfi_def_cfa_offset 36
 2057              		@ sp needed
 2058 004a BDE8F08F 		pop	{r4, r5, r6, r7, r8, r9, r10, fp, pc}
 2059              	.LVL193:
 2060              	.L146:
 2061              	.LCFI45:
 2062              		.cfi_restore_state
 375:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (ptr == NULL) {
 2063              		.loc 1 375 0
 2064 004e 0398     		ldr	r0, [sp, #12]
 2065 0050 FFF7FEFF 		bl	malloc
 2066              	.LVL194:
 376:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		goto error;
 2067              		.loc 1 376 0
 2068 0054 8346     		mov	fp, r0
 2069 0056 0028     		cmp	r0, #0
 2070 0058 3BD0     		beq	.L141
 361:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t retr = BSP_SD_ERROR;
 2071              		.loc 1 361 0
 2072 005a 0024     		movs	r4, #0
 2073 005c 2FE0     		b	.L137
 2074              	.LVL195:
 2075              	.L142:
 384:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 							  SD_ANSWER_R1_EXPECTED);
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 57


 2076              		.loc 1 384 0
 2077 005e 4246     		mov	r2, r8
 2078              	.L138:
 384:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 							  SD_ANSWER_R1_EXPECTED);
 2079              		.loc 1 384 0 is_stmt 0 discriminator 4
 2080 0060 0023     		movs	r3, #0
 2081 0062 0093     		str	r3, [sp]
 2082 0064 FF23     		movs	r3, #255
 2083 0066 B1FBF2F2 		udiv	r2, r1, r2
 2084 006a 1821     		movs	r1, #24
 2085 006c 04A8     		add	r0, sp, #16
 2086 006e FFF7FEFF 		bl	SD_SendCmd
 2087              	.LVL196:
 2088 0072 0498     		ldr	r0, [sp, #16]	@ unaligned
 386:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			goto error;
 2089              		.loc 1 386 0 is_stmt 1 discriminator 4
 2090 0074 C0B2     		uxtb	r0, r0
 2091 0076 A0BB     		cbnz	r0, .L143
 391:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_IO_WriteByte(SD_DUMMY_BYTE);
 2092              		.loc 1 391 0
 2093 0078 FF20     		movs	r0, #255
 2094 007a FFF7FEFF 		bl	SD_IO_WriteByte
 2095              	.LVL197:
 392:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 2096              		.loc 1 392 0
 2097 007e FF20     		movs	r0, #255
 2098 0080 FFF7FEFF 		bl	SD_IO_WriteByte
 2099              	.LVL198:
 395:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 2100              		.loc 1 395 0
 2101 0084 FE20     		movs	r0, #254
 2102 0086 FFF7FEFF 		bl	SD_IO_WriteByte
 2103              	.LVL199:
 398:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 2104              		.loc 1 398 0
 2105 008a 039A     		ldr	r2, [sp, #12]
 2106 008c 5946     		mov	r1, fp
 2107 008e 0AEB0400 		add	r0, r10, r4
 2108 0092 FFF7FEFF 		bl	SD_IO_WriteReadData
 2109              	.LVL200:
 401:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 2110              		.loc 1 401 0
 2111 0096 4444     		add	r4, r4, r8
 2112              	.LVL201:
 404:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_IO_WriteByte(SD_DUMMY_BYTE);
 2113              		.loc 1 404 0
 2114 0098 FF20     		movs	r0, #255
 2115 009a FFF7FEFF 		bl	SD_IO_WriteByte
 2116              	.LVL202:
 405:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 2117              		.loc 1 405 0
 2118 009e FF20     		movs	r0, #255
 2119 00a0 FFF7FEFF 		bl	SD_IO_WriteByte
 2120              	.LVL203:
 408:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Set response value to failure
 2121              		.loc 1 408 0
 2122 00a4 FFF7FEFF 		bl	SD_GetDataResponse
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 58


 2123              	.LVL204:
 2124 00a8 0528     		cmp	r0, #5
 2125 00aa 1CD1     		bne	.L144
 413:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_IO_WriteByte(SD_DUMMY_BYTE);
 2126              		.loc 1 413 0
 2127 00ac 0122     		movs	r2, #1
 2128 00ae 2021     		movs	r1, #32
 2129 00b0 0E48     		ldr	r0, .L147
 2130 00b2 FFF7FEFF 		bl	HAL_GPIO_WritePin
 2131              	.LVL205:
 414:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 2132              		.loc 1 414 0
 2133 00b6 FF20     		movs	r0, #255
 2134 00b8 FFF7FEFF 		bl	SD_IO_WriteByte
 2135              	.LVL206:
 381:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Send CMD24 (SD_CMD_WRITE_SINGLE_BLOCK) to write blocks	and
 2136              		.loc 1 381 0
 2137 00bc 3D46     		mov	r5, r7
 2138              	.LVL207:
 2139              	.L137:
 2140 00be 6F1E     		subs	r7, r5, #1
 2141              	.LVL208:
 2142 00c0 45B1     		cbz	r5, .L136
 384:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 							  SD_ANSWER_R1_EXPECTED);
 2143              		.loc 1 384 0
 2144 00c2 04EB0901 		add	r1, r4, r9
 2145 00c6 0A4B     		ldr	r3, .L147+4
 2146 00c8 1B88     		ldrh	r3, [r3]
 2147 00ca 012B     		cmp	r3, #1
 2148 00cc C7D0     		beq	.L142
 2149 00ce 0122     		movs	r2, #1
 2150 00d0 C6E7     		b	.L138
 2151              	.LVL209:
 2152              	.L141:
 362:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t *ptr = NULL;
 2153              		.loc 1 362 0
 2154 00d2 0126     		movs	r6, #1
 2155              	.LVL210:
 2156              	.L136:
 419:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		free(ptr);
 2157              		.loc 1 419 0
 2158 00d4 BBF1000F 		cmp	fp, #0
 2159 00d8 ADD0     		beq	.L135
 420:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 2160              		.loc 1 420 0
 2161 00da 5846     		mov	r0, fp
 2162 00dc FFF7FEFF 		bl	free
 2163              	.LVL211:
 2164 00e0 A9E7     		b	.L135
 2165              	.LVL212:
 2166              	.L143:
 362:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t *ptr = NULL;
 2167              		.loc 1 362 0
 2168 00e2 0126     		movs	r6, #1
 2169 00e4 F6E7     		b	.L136
 2170              	.L144:
 2171 00e6 0126     		movs	r6, #1
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 59


 2172 00e8 F4E7     		b	.L136
 2173              	.L148:
 2174 00ea 00BF     		.align	2
 2175              	.L147:
 2176 00ec 000C0140 		.word	1073810432
 2177 00f0 00000000 		.word	.LANCHOR1
 2178              		.cfi_endproc
 2179              	.LFE80:
 2181              		.section	.text.BSP_SD_GetCardInfo,"ax",%progbits
 2182              		.align	1
 2183              		.global	BSP_SD_GetCardInfo
 2184              		.syntax unified
 2185              		.thumb
 2186              		.thumb_func
 2187              		.fpu softvfp
 2189              	BSP_SD_GetCardInfo:
 2190              	.LFB81:
 431:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t status;
 2191              		.loc 1 431 0
 2192              		.cfi_startproc
 2193              		@ args = 0, pretend = 0, frame = 0
 2194              		@ frame_needed = 0, uses_anonymous_args = 0
 2195              	.LVL213:
 2196 0000 38B5     		push	{r3, r4, r5, lr}
 2197              	.LCFI46:
 2198              		.cfi_def_cfa_offset 16
 2199              		.cfi_offset 3, -16
 2200              		.cfi_offset 4, -12
 2201              		.cfi_offset 5, -8
 2202              		.cfi_offset 14, -4
 2203 0002 0446     		mov	r4, r0
 434:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	status |= SD_GetCIDRegister(&(pCardInfo->Cid));
 2204              		.loc 1 434 0
 2205 0004 FFF7FEFF 		bl	SD_GetCSDRegister
 2206              	.LVL214:
 2207 0008 0546     		mov	r5, r0
 2208              	.LVL215:
 435:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (flag_SDHC == 1) {
 2209              		.loc 1 435 0
 2210 000a 04F11800 		add	r0, r4, #24
 2211 000e FFF7FEFF 		bl	SD_GetCIDRegister
 2212              	.LVL216:
 2213 0012 2843     		orrs	r0, r0, r5
 2214 0014 C0B2     		uxtb	r0, r0
 2215              	.LVL217:
 436:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		pCardInfo->CardBlockSize = 512;
 2216              		.loc 1 436 0
 2217 0016 104B     		ldr	r3, .L154
 2218 0018 1B88     		ldrh	r3, [r3]
 2219 001a 012B     		cmp	r3, #1
 2220 001c 11D0     		beq	.L153
 440:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		pCardInfo->CardCapacity *= (1 << (pCardInfo->Csd.version.v1.DeviceSizeMul + 2));
 2221              		.loc 1 440 0
 2222 001e 2389     		ldrh	r3, [r4, #8]
 2223 0020 C3F38B03 		ubfx	r3, r3, #2, #12
 2224 0024 0133     		adds	r3, r3, #1
 441:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		pCardInfo->CardBlockSize = 1 << (pCardInfo->Csd.RdBlockLen);
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 60


 2225              		.loc 1 441 0
 2226 0026 227B     		ldrb	r2, [r4, #12]	@ zero_extendqisi2
 2227 0028 02F00702 		and	r2, r2, #7
 2228 002c 0232     		adds	r2, r2, #2
 2229 002e 9340     		lsls	r3, r3, r2
 442:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		pCardInfo->CardCapacity *= pCardInfo->CardBlockSize;
 2230              		.loc 1 442 0
 2231 0030 6279     		ldrb	r2, [r4, #5]	@ zero_extendqisi2
 2232 0032 1109     		lsrs	r1, r2, #4
 2233 0034 0122     		movs	r2, #1
 2234 0036 8A40     		lsls	r2, r2, r1
 2235 0038 6263     		str	r2, [r4, #52]
 443:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	}
 2236              		.loc 1 443 0
 2237 003a 02FB03F3 		mul	r3, r2, r3
 2238 003e 2363     		str	r3, [r4, #48]
 2239              	.L151:
 447:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 2240              		.loc 1 447 0
 2241 0040 38BD     		pop	{r3, r4, r5, pc}
 2242              	.LVL218:
 2243              	.L153:
 437:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		pCardInfo->CardCapacity = (pCardInfo->Csd.version.v2.DeviceSize + 1) * pCardInfo->CardBlockSize;
 2244              		.loc 1 437 0
 2245 0042 4FF40073 		mov	r3, #512
 2246 0046 6363     		str	r3, [r4, #52]
 438:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	} else {
 2247              		.loc 1 438 0
 2248 0048 A368     		ldr	r3, [r4, #8]
 2249 004a C3F39513 		ubfx	r3, r3, #6, #22
 2250 004e 0133     		adds	r3, r3, #1
 2251 0050 5B02     		lsls	r3, r3, #9
 2252 0052 2363     		str	r3, [r4, #48]
 2253 0054 F4E7     		b	.L151
 2254              	.L155:
 2255 0056 00BF     		.align	2
 2256              	.L154:
 2257 0058 00000000 		.word	.LANCHOR1
 2258              		.cfi_endproc
 2259              	.LFE81:
 2261              		.section	.text.BSP_SD_GetStatus,"ax",%progbits
 2262              		.align	1
 2263              		.global	BSP_SD_GetStatus
 2264              		.syntax unified
 2265              		.thumb
 2266              		.thumb_func
 2267              		.fpu softvfp
 2269              	BSP_SD_GetStatus:
 2270              	.LFB82:
 450:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CmdAnswer_typedef retr;
 2271              		.loc 1 450 0
 2272              		.cfi_startproc
 2273              		@ args = 0, pretend = 0, frame = 8
 2274              		@ frame_needed = 0, uses_anonymous_args = 0
 2275 0000 00B5     		push	{lr}
 2276              	.LCFI47:
 2277              		.cfi_def_cfa_offset 4
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 61


 2278              		.cfi_offset 14, -4
 2279 0002 85B0     		sub	sp, sp, #20
 2280              	.LCFI48:
 2281              		.cfi_def_cfa_offset 24
 454:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CS_HIGH();
 2282              		.loc 1 454 0
 2283 0004 0223     		movs	r3, #2
 2284 0006 0093     		str	r3, [sp]
 2285 0008 FF23     		movs	r3, #255
 2286 000a 0022     		movs	r2, #0
 2287 000c 0D21     		movs	r1, #13
 2288 000e 02A8     		add	r0, sp, #8
 2289 0010 FFF7FEFF 		bl	SD_SendCmd
 2290              	.LVL219:
 455:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteByte(SD_DUMMY_BYTE);
 2291              		.loc 1 455 0
 2292 0014 0122     		movs	r2, #1
 2293 0016 2021     		movs	r1, #32
 2294 0018 0848     		ldr	r0, .L160
 2295 001a FFF7FEFF 		bl	HAL_GPIO_WritePin
 2296              	.LVL220:
 456:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 2297              		.loc 1 456 0
 2298 001e FF20     		movs	r0, #255
 2299 0020 FFF7FEFF 		bl	SD_IO_WriteByte
 2300              	.LVL221:
 459:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		return BSP_SD_OK;
 2301              		.loc 1 459 0
 2302 0024 9DF80830 		ldrb	r3, [sp, #8]	@ zero_extendqisi2
 2303 0028 23B9     		cbnz	r3, .L158
 459:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		return BSP_SD_OK;
 2304              		.loc 1 459 0 is_stmt 0 discriminator 1
 2305 002a 9DF80900 		ldrb	r0, [sp, #9]	@ zero_extendqisi2
 2306 002e 10B1     		cbz	r0, .L157
 463:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** }
 2307              		.loc 1 463 0 is_stmt 1
 2308 0030 0120     		movs	r0, #1
 2309 0032 00E0     		b	.L157
 2310              	.L158:
 2311 0034 0120     		movs	r0, #1
 2312              	.L157:
 464:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 2313              		.loc 1 464 0
 2314 0036 05B0     		add	sp, sp, #20
 2315              	.LCFI49:
 2316              		.cfi_def_cfa_offset 4
 2317              		@ sp needed
 2318 0038 5DF804FB 		ldr	pc, [sp], #4
 2319              	.L161:
 2320              		.align	2
 2321              	.L160:
 2322 003c 000C0140 		.word	1073810432
 2323              		.cfi_endproc
 2324              	.LFE82:
 2326              		.section	.text.BSP_SD_Erase,"ax",%progbits
 2327              		.align	1
 2328              		.global	BSP_SD_Erase
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 62


 2329              		.syntax unified
 2330              		.thumb
 2331              		.thumb_func
 2332              		.fpu softvfp
 2334              	BSP_SD_Erase:
 2335              	.LFB83:
 467:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	uint8_t retr = BSP_SD_ERROR;
 2336              		.loc 1 467 0
 2337              		.cfi_startproc
 2338              		@ args = 0, pretend = 0, frame = 16
 2339              		@ frame_needed = 0, uses_anonymous_args = 0
 2340              	.LVL222:
 2341 0000 10B5     		push	{r4, lr}
 2342              	.LCFI50:
 2343              		.cfi_def_cfa_offset 8
 2344              		.cfi_offset 4, -8
 2345              		.cfi_offset 14, -4
 2346 0002 86B0     		sub	sp, sp, #24
 2347              	.LCFI51:
 2348              		.cfi_def_cfa_offset 32
 2349 0004 0C46     		mov	r4, r1
 2350              	.LVL223:
 472:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CS_HIGH();
 2351              		.loc 1 472 0
 2352 0006 0023     		movs	r3, #0
 2353 0008 0093     		str	r3, [sp]
 2354 000a FF23     		movs	r3, #255
 2355 000c 0246     		mov	r2, r0
 2356 000e 2021     		movs	r1, #32
 2357              	.LVL224:
 2358 0010 04A8     		add	r0, sp, #16
 2359              	.LVL225:
 2360 0012 FFF7FEFF 		bl	SD_SendCmd
 2361              	.LVL226:
 473:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_IO_WriteByte(SD_DUMMY_BYTE);
 2362              		.loc 1 473 0
 2363 0016 0122     		movs	r2, #1
 2364 0018 2021     		movs	r1, #32
 2365 001a 1C48     		ldr	r0, .L170
 2366 001c FFF7FEFF 		bl	HAL_GPIO_WritePin
 2367              	.LVL227:
 474:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	if (response.r1 == SD_R1_NO_ERROR) {
 2368              		.loc 1 474 0
 2369 0020 FF20     		movs	r0, #255
 2370 0022 FFF7FEFF 		bl	SD_IO_WriteByte
 2371              	.LVL228:
 475:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		// Send CMD33 (Erase group end) and Check if the SD acknowledged the erase command: R1 response (
 2372              		.loc 1 475 0
 2373 0026 9DF81030 		ldrb	r3, [sp, #16]	@ zero_extendqisi2
 2374 002a 1BB1     		cbz	r3, .L168
 468:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CmdAnswer_typedef response;
 2375              		.loc 1 468 0
 2376 002c 0124     		movs	r4, #1
 2377              	.LVL229:
 2378              	.L163:
 493:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 
 2379              		.loc 1 493 0
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 63


 2380 002e 2046     		mov	r0, r4
 2381 0030 06B0     		add	sp, sp, #24
 2382              	.LCFI52:
 2383              		.cfi_remember_state
 2384              		.cfi_def_cfa_offset 8
 2385              		@ sp needed
 2386 0032 10BD     		pop	{r4, pc}
 2387              	.LVL230:
 2388              	.L168:
 2389              	.LCFI53:
 2390              		.cfi_restore_state
 477:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_CS_HIGH();
 2391              		.loc 1 477 0
 2392 0034 0093     		str	r3, [sp]
 2393 0036 FF23     		movs	r3, #255
 2394 0038 2246     		mov	r2, r4
 2395 003a 2121     		movs	r1, #33
 2396 003c 02A8     		add	r0, sp, #8
 2397 003e FFF7FEFF 		bl	SD_SendCmd
 2398              	.LVL231:
 2399 0042 0298     		ldr	r0, [sp, #8]	@ unaligned
 2400 0044 0490     		str	r0, [sp, #16]
 478:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		SD_IO_WriteByte(SD_DUMMY_BYTE);
 2401              		.loc 1 478 0
 2402 0046 0122     		movs	r2, #1
 2403 0048 2021     		movs	r1, #32
 2404 004a 1048     		ldr	r0, .L170
 2405 004c FFF7FEFF 		bl	HAL_GPIO_WritePin
 2406              	.LVL232:
 479:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		if (response.r1 == SD_R1_NO_ERROR) {
 2407              		.loc 1 479 0
 2408 0050 FF20     		movs	r0, #255
 2409 0052 FFF7FEFF 		bl	SD_IO_WriteByte
 2410              	.LVL233:
 480:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			// Send CMD38 (Erase) and Check if the SD acknowledged the erase command: R1 response (0x00: no 
 2411              		.loc 1 480 0
 2412 0056 9DF81030 		ldrb	r3, [sp, #16]	@ zero_extendqisi2
 2413 005a 0BB1     		cbz	r3, .L169
 468:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CmdAnswer_typedef response;
 2414              		.loc 1 468 0
 2415 005c 0124     		movs	r4, #1
 2416              	.LVL234:
 2417 005e E6E7     		b	.L163
 2418              	.LVL235:
 2419              	.L169:
 482:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			if (response.r1 == SD_R1_NO_ERROR) {
 2420              		.loc 1 482 0
 2421 0060 0123     		movs	r3, #1
 2422 0062 0093     		str	r3, [sp]
 2423 0064 FF23     		movs	r3, #255
 2424 0066 0022     		movs	r2, #0
 2425 0068 2621     		movs	r1, #38
 2426 006a 02A8     		add	r0, sp, #8
 2427 006c FFF7FEFF 		bl	SD_SendCmd
 2428              	.LVL236:
 2429 0070 0298     		ldr	r0, [sp, #8]	@ unaligned
 483:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 				retr = BSP_SD_OK;
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 64


 2430              		.loc 1 483 0
 2431 0072 C4B2     		uxtb	r4, r0
 2432              	.LVL237:
 2433 0074 04B1     		cbz	r4, .L164
 468:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 	SD_CmdAnswer_typedef response;
 2434              		.loc 1 468 0
 2435 0076 0124     		movs	r4, #1
 2436              	.L164:
 2437              	.LVL238:
 486:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 			SD_IO_WriteByte(SD_DUMMY_BYTE);
 2438              		.loc 1 486 0
 2439 0078 0122     		movs	r2, #1
 2440 007a 2021     		movs	r1, #32
 2441 007c 0348     		ldr	r0, .L170
 2442 007e FFF7FEFF 		bl	HAL_GPIO_WritePin
 2443              	.LVL239:
 487:Middlewares/Third_Party/FatFs/Src/stm32_ff_link.c **** 		}
 2444              		.loc 1 487 0
 2445 0082 FF20     		movs	r0, #255
 2446 0084 FFF7FEFF 		bl	SD_IO_WriteByte
 2447              	.LVL240:
 2448 0088 D1E7     		b	.L163
 2449              	.L171:
 2450 008a 00BF     		.align	2
 2451              	.L170:
 2452 008c 000C0140 		.word	1073810432
 2453              		.cfi_endproc
 2454              	.LFE83:
 2456              		.global	flag_SDHC
 2457              		.global	SdStatus
 2458              		.section	.rodata
 2459              		.align	2
 2460              		.set	.LANCHOR0,. + 0
 2461              	.LC0:
 2462 0000 FF       		.byte	-1
 2463 0001 FF       		.byte	-1
 2464 0002 FF       		.byte	-1
 2465 0003 FF       		.byte	-1
 2466 0004 FF       		.byte	-1
 2467              		.section	.bss.SdStatus,"aw",%nobits
 2468              		.set	.LANCHOR2,. + 0
 2471              	SdStatus:
 2472 0000 00       		.space	1
 2473              		.section	.bss.flag_SDHC,"aw",%nobits
 2474              		.align	1
 2475              		.set	.LANCHOR1,. + 0
 2478              	flag_SDHC:
 2479 0000 0000     		.space	2
 2480              		.text
 2481              	.Letext0:
 2482              		.file 2 "c:\\program files (x86)\\embedded toolchain\\gnu tools arm embedded\\7 2017-q4-major\\arm
 2483              		.file 3 "c:\\program files (x86)\\embedded toolchain\\gnu tools arm embedded\\7 2017-q4-major\\arm
 2484              		.file 4 "Drivers/CMSIS/Include/core_cm3.h"
 2485              		.file 5 "Drivers/CMSIS/Device/ST/STM32F1xx/Include/system_stm32f1xx.h"
 2486              		.file 6 "Drivers/CMSIS/Device/ST/STM32F1xx/Include/stm32f103xb.h"
 2487              		.file 7 "c:\\program files (x86)\\embedded toolchain\\gnu tools arm embedded\\7 2017-q4-major\\arm
 2488              		.file 8 "c:\\program files (x86)\\embedded toolchain\\gnu tools arm embedded\\7 2017-q4-major\\arm
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 65


 2489              		.file 9 "c:\\program files (x86)\\embedded toolchain\\gnu tools arm embedded\\7 2017-q4-major\\lib
 2490              		.file 10 "c:\\program files (x86)\\embedded toolchain\\gnu tools arm embedded\\7 2017-q4-major\\ar
 2491              		.file 11 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_def.h"
 2492              		.file 12 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_gpio.h"
 2493              		.file 13 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_dma.h"
 2494              		.file 14 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_spi.h"
 2495              		.file 15 "Inc/..\\Drivers\\STM32F1xx_HAL_Driver\\Inc\\stm32f1xx_hal.h"
 2496              		.file 16 "Middlewares/Third_Party/FatFs/Src/stm32_ff_link.h"
 2497              		.file 17 "c:\\program files (x86)\\embedded toolchain\\gnu tools arm embedded\\7 2017-q4-major\\ar
 2498              		.file 18 "c:\\program files (x86)\\embedded toolchain\\gnu tools arm embedded\\7 2017-q4-major\\ar
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 66


DEFINED SYMBOLS
                            *ABS*:00000000 stm32_ff_link.c
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:16     .text.SPIx_GPIO_Init:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:22     .text.SPIx_GPIO_Init:00000000 SPIx_GPIO_Init
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:142    .text.SPIx_GPIO_Init:000000a0 $d
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:149    .text.SPIx_Init:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:155    .text.SPIx_Init:00000000 SPIx_Init
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:216    .text.SPIx_Init:00000040 $d
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:222    .text.SPIx_Error:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:228    .text.SPIx_Error:00000000 SPIx_Error
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:251    .text.SPIx_Error:00000010 $d
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:256    .text.SPIx_WriteReadData:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:262    .text.SPIx_WriteReadData:00000000 SPIx_WriteReadData
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:312    .text.SPIx_WriteReadData:00000024 $d
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:317    .text.SPIx_WriteData:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:323    .text.SPIx_WriteData:00000000 SPIx_WriteData
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:361    .text.SPIx_WriteData:0000001c $d
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:366    .text.SPIx_FlushFifo:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:372    .text.SPIx_FlushFifo:00000000 SPIx_FlushFifo
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:392    .text.SPIx_FlushFifo:0000000c $d
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:397    .text.SD_IO_WriteReadData:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:404    .text.SD_IO_WriteReadData:00000000 SD_IO_WriteReadData
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:425    .text.SD_IO_WriteByte:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:432    .text.SD_IO_WriteByte:00000000 SD_IO_WriteByte
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:465    .text.SD_IO_Init:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:472    .text.SD_IO_Init:00000000 SD_IO_Init
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:517    .text.SD_IO_Init:00000024 $d
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:522    .text.SD_ReadData:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:528    .text.SD_ReadData:00000000 SD_ReadData
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:566    .text.SD_SendCmd:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:572    .text.SD_SendCmd:00000000 SD_SendCmd
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:635    .text.SD_SendCmd:0000005a $d
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:641    .text.SD_SendCmd:00000060 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:736    .text.SD_SendCmd:000000dc $d
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:742    .text.SD_GoIdleState:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:748    .text.SD_GoIdleState:00000000 SD_GoIdleState
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1031   .text.SD_GoIdleState:000001c0 $d
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1037   .text.SD_WaitData:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1043   .text.SD_WaitData:00000000 SD_WaitData
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1097   .text.SD_GetDataResponse:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1103   .text.SD_GetDataResponse:00000000 SD_GetDataResponse
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1179   .text.SD_GetDataResponse:00000050 $d
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1184   .text.SD_GetCSDRegister:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1190   .text.SD_GetCSDRegister:00000000 SD_GetCSDRegister
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1486   .text.SD_GetCSDRegister:00000234 $d
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1492   .text.SD_GetCIDRegister:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1498   .text.SD_GetCIDRegister:00000000 SD_GetCIDRegister
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1674   .text.SD_GetCIDRegister:00000108 $d
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1679   .text.SD_IO_ReadData:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1686   .text.SD_IO_ReadData:00000000 SD_IO_ReadData
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1710   .text.SD_IO_WriteData:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1717   .text.SD_IO_WriteData:00000000 SD_IO_WriteData
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1741   .text.BSP_SD_Init:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1748   .text.BSP_SD_Init:00000000 BSP_SD_Init
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1774   .text.BSP_SD_Init:00000014 $d
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1779   .text.BSP_SD_ReadBlocks:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1786   .text.BSP_SD_ReadBlocks:00000000 BSP_SD_ReadBlocks
ARM GAS  C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s 			page 67


C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1972   .text.BSP_SD_ReadBlocks:000000e4 $d
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1978   .text.BSP_SD_WriteBlocks:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:1985   .text.BSP_SD_WriteBlocks:00000000 BSP_SD_WriteBlocks
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:2176   .text.BSP_SD_WriteBlocks:000000ec $d
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:2182   .text.BSP_SD_GetCardInfo:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:2189   .text.BSP_SD_GetCardInfo:00000000 BSP_SD_GetCardInfo
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:2257   .text.BSP_SD_GetCardInfo:00000058 $d
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:2262   .text.BSP_SD_GetStatus:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:2269   .text.BSP_SD_GetStatus:00000000 BSP_SD_GetStatus
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:2322   .text.BSP_SD_GetStatus:0000003c $d
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:2327   .text.BSP_SD_Erase:00000000 $t
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:2334   .text.BSP_SD_Erase:00000000 BSP_SD_Erase
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:2452   .text.BSP_SD_Erase:0000008c $d
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:2478   .bss.flag_SDHC:00000000 flag_SDHC
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:2471   .bss.SdStatus:00000000 SdStatus
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:2459   .rodata:00000000 $d
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:2472   .bss.SdStatus:00000000 $d
C:\Users\Patrick\AppData\Local\Temp\cc2S9pAR.s:2474   .bss.flag_SDHC:00000000 $d

UNDEFINED SYMBOLS
HAL_GPIO_Init
HAL_SPI_GetState
HAL_SPI_Init
hspi1
HAL_SPI_DeInit
HAL_SPI_TransmitReceive
HAL_SPI_Transmit
HAL_SPIEx_FlushRxFifo
HAL_GPIO_WritePin
HAL_Delay
free
malloc
memset
